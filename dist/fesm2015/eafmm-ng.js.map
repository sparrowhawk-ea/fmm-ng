{"version":3,"file":"eafmm-ng.js","sources":["../../src/lib/fmm-ng.module.ts","../../src/lib/fmm-ng-material.ts","../../src/eafmm-ng.ts"],"sourcesContent":["import { Component, ElementRef, EventEmitter, Input, NgModule, OnChanges, OnDestroy, OnInit, Output } from '@angular/core';\nimport { AbstractControl, FormGroup } from '@angular/forms';\nimport { Subscription } from 'rxjs';\nimport {\n\tFmm,\n\tFmmElementFactory,\n\tFmmFramework,\n\tFmmMapString,\n\tFmmMinimap,\n\tFmmMinimapCreateParam,\n\tFmmMinimapSnapshot,\n\tFmmPanel,\n\tFmmStore,\n\tFmmStoreItem,\n\tFmmWidgetFactory\n} from '@eafmm/core';\n\n// =================================================================================================================================\n//\t\t\t\t\t\tF M M N G M I N I M A P\n// =================================================================================================================================\n@Component({ selector: 'fmm-ng-minimap', template: '' })\nexport class FmmNgMinimap implements OnChanges, OnDestroy, OnInit, Partial<FmmMinimap> {\n\t@Input() public aggregateLabels?: FmmMapString;\n\t@Input() public anchor: HTMLElement;\n\t@Input() public customWidgetIds: string[];\n\t@Input() public debounceMsec: number;\n\t@Input() public dynamicLabels?: string[];\n\t@Input() public formGroup: FormGroup;\n\t@Input() public framework: FmmFramework;\n\t@Input() public key: string;\n\t@Input() public namelessControls: FmmNgNamelessControls;\n\t@Input() public page: HTMLElement;\n\t@Input() public panel: FmmNgPanel;\n\t@Input() public parent: HTMLElement;\n\t@Input() public title: string;\n\t@Input() public usePanelDetail: boolean;\n\t@Input() public useWidthToScale: boolean;\n\t@Input() public verbosity = 0;\n\t@Input() public widgetFactories?: FmmWidgetFactory[];\n\t@Output() public readonly update = new EventEmitter<FmmMinimapSnapshot>();\n\tprivate readonly form: HTMLFormElement;\n\n\tprivate minimap: FmmMinimap;\n\tprivate previousKey: string;\n\tprivate store: Store;\n\n\t// =============================================================================================================================\n\tpublic constructor(hostRef: ElementRef) {\n\t\tlet form = hostRef.nativeElement as Element;\n\t\twhile (form && form.tagName !== 'FORM') form = form.parentElement;\n\t\tthis.form = form as HTMLFormElement;\n\t}\n\n\t// =============================================================================================================================\n\tpublic destructor(): void {\n\t\tif (!this.minimap) return;\n\t\tthis.minimap.destructor();\n\t\tthis.minimap = undefined;\n\t}\n\n\t// =============================================================================================================================\n\tpublic ngOnChanges(): void {\n\t\tif (!this.minimap) return;\n\t\tif (this.key !== this.previousKey) {\n\t\t\tthis.minimap.destructor();\n\t\t\tthis.ngOnInit();\n\t\t} else {\n\t\t\tthis.store.namelessControls = this.namelessControls;\n\t\t\tthis.minimap.compose(this.customWidgetIds);\t\n\t\t}\n\t}\n\n\t// =============================================================================================================================\n\tpublic ngOnDestroy(): void {\n\t\tif (!this.minimap) return;\n\t\tthis.minimap.detach();\n\t\tthis.store = undefined;\n\t}\n\n\t// =============================================================================================================================\n\tpublic ngOnInit(): void {\n\t\tconst p: FmmMinimapCreateParam = {\n\t\t\taggregateLabels: this.aggregateLabels,\n\t\t\tanchor: this.anchor,\n\t\t\tdebounceMsec: this.debounceMsec,\n\t\t\tdynamicLabels: this.dynamicLabels,\n\t\t\tform: this.form,\n\t\t\tframework: this.framework,\n\t\t\tonUpdate: (snapshot: FmmMinimapSnapshot) => this.update.next(snapshot),\n\t\t\tpage: this.page,\n\t\t\tstore: this.store = new Store(this.formGroup),\n\t\t\ttitle: this.title,\n\t\t\tusePanelDetail: this.usePanelDetail !== undefined,\n\t\t\tuseWidthToScale: this.useWidthToScale !== undefined,\n\t\t\tverbosity: this.verbosity,\n\t\t\twidgetFactories: this.widgetFactories\n\t\t};\n\t\tthis.minimap = this.panel\n\t\t\t? G.PANELMAP.get(this.panel)?.createMinimap(p)\n\t\t\t: Fmm.createMinimap(p, this.parent, new ElementFactory(this.parent || this.anchor));\n\t\tthis.previousKey = this.key;\n\t\tthis.ngOnChanges();\n\t}\n\n\t// =============================================================================================================================\n\tpublic takeSnapshot(): boolean {\n\t\treturn this.minimap?.takeSnapshot();\n\t}\n}\n\n// =================================================================================================================================\n//\t\t\t\t\t\tF M M N G P A N E L\n// =================================================================================================================================\n@Component({ selector: 'fmm-ng-panel', template: '' })\nexport class FmmNgPanel implements OnDestroy, OnInit, Partial<FmmPanel> {\n\t@Input() public readonly detailParent: HTMLElement;\n\t@Input() public readonly vertical: boolean;\n\n\tpublic readonly ef: FmmElementFactory;\n\tprivate minimapPanel: FmmPanel;\n\n\t// =============================================================================================================================\n\tpublic constructor(private readonly hostRef: ElementRef) {\n\t\tthis.ef = new ElementFactory(hostRef.nativeElement as Element);\n\t}\n\n\t// =============================================================================================================================\n\tpublic ngOnDestroy(): void {\n\t\tthis.minimapPanel.destructor();\n\t\tG.PANELMAP.delete(this);\n\t\tthis.minimapPanel = undefined;\n\t}\n\n\t// =============================================================================================================================\n\tpublic ngOnInit(): void {\n\t\tconst host = this.hostRef.nativeElement as HTMLElement;\n\t\tconst vertical = this.vertical !== undefined;\n\t\tthis.minimapPanel = Fmm.createPanel(host, this.detailParent, vertical, this.ef);\n\t\tG.PANELMAP.set(this, this.minimapPanel);\n\t}\n\n\t// =============================================================================================================================\n\tpublic destroyDetached(): void {\n\t\treturn this.minimapPanel?.destroyDetached();\n\t}\n}\n\n// =================================================================================================================================\n//\t\t\t\t\t\tF M M N G M O D U L E\n// =================================================================================================================================\n@NgModule({ declarations: [FmmNgMinimap, FmmNgPanel], exports: [FmmNgMinimap, FmmNgPanel] })\nexport class FmmNgModule {}\n\n// =================================================================================================================================\n//\t\t\t\t\t\tF M M N G N A M E L E S S C O N T R O L S\n// =================================================================================================================================\nexport type FmmNgNamelessControls = Record<string, AbstractControl>;\n\n// =================================================================================================================================\n// =================================================================================================================================\n// =================================================\tP R I V A T E\t============================================================\n// =================================================================================================================================\n// =================================================================================================================================\n\n// =================================================================================================================================\n//\t\t\t\t\t\tE L E M E N T F A C T O R Y\n// =================================================================================================================================\nclass ElementFactory implements FmmElementFactory {\n\tprivate readonly ngContentAttribute: string;\n\n\t// =============================================================================================================================\n\tpublic constructor(p: Element) {\n\t\tlet ngContentAttribute: string; // set attribute on elements to use non-global CSS\n\t\tif (Element.prototype.getAttributeNames !== undefined) {\n\t\t\tfor (; p && !ngContentAttribute; p = p.parentElement) {\n\t\t\t\tconst names = p.getAttributeNames();\n\t\t\t\tngContentAttribute = names.find((a: string) => a.startsWith('_ngcontent-'));\n\t\t\t}\n\t\t} else {\n\t\t\tfor (; p && !ngContentAttribute; p = p.parentElement) {\n\t\t\t\tconst names = Array.prototype.map.call(p.attributes, (a: Attr) => a.name) as string[];\n\t\t\t\tngContentAttribute = names.find((a: string) => a.startsWith('_ngcontent-'));\n\t\t\t}\n\t\t}\n\t\tif (!ngContentAttribute) throw new Error('FormMinimap: missing _ngcontent- attribute');\n\t\tthis.ngContentAttribute = ngContentAttribute;\n\t}\n\n\t// =============================================================================================================================\n\tpublic createElement(tagName: string) {\n\t\tconst e = document.createElement(tagName);\n\t\te.setAttribute(this.ngContentAttribute, '');\n\t\treturn e;\n\t}\n\n\t// =============================================================================================================================\n\tpublic createElementNS(namespaceURI: string, qualifiedName: string) {\n\t\tconst e = document.createElementNS(namespaceURI, qualifiedName);\n\t\te.setAttribute(this.ngContentAttribute, '');\n\t\treturn e;\n\t}\n}\n\n// =================================================================================================================================\n//\t\t\t\t\t\tG\n// =================================================================================================================================\nconst G: {\n\tPANELMAP: WeakMap<FmmNgPanel, FmmPanel>;\n} = {\n\tPANELMAP: new WeakMap()\n};\n\n// =================================================================================================================================\n//\t\t\t\t\t\tS T O R E I T E M\n// =================================================================================================================================\nclass StoreItem implements FmmStoreItem {\n\tprivate readonly se: HTMLSelectElement;\n\n\t// =============================================================================================================================\n\tpublic constructor(\n\t\te: HTMLElement,\n\t\tlistener: EventListener,\n\t\tprivate readonly name: string,\n\t\tprivate readonly control: AbstractControl\n\t) {\n\t\tthis.se = e.tagName === 'SELECT' ? (e as HTMLSelectElement) : undefined;\n\t\tconst subscription = new Subscription();\n\t\tsubscription.add(this.control.statusChanges.subscribe(listener));\n\t\tsubscription.add(this.control.valueChanges.subscribe(listener));\n\t\tthis.destructor = () => subscription.unsubscribe();\n\t}\n\n\t// =============================================================================================================================\n\tpublic destructor(): void {\n\t\t// function body overwritten in constructor\n\t}\n\n\t// =============================================================================================================================\n\tpublic getError(hasValue: boolean): string {\n\t\tconst errors = this.control.errors;\n\t\tlet keys = errors ? Object.keys(errors) : [];\n\t\tif (hasValue && keys.length) keys = keys.filter(k => k !== 'required'); // IE11 SELECT bug\n\t\treturn keys.length ? keys.join(',') : undefined;\n\t}\n\n\t// =============================================================================================================================\n\tpublic getName(): string {\n\t\treturn this.name;\n\t}\n\n\t// =============================================================================================================================\n\tpublic getValue() {\n\t\tconst value = this.control.value as unknown;\n\t\tif (!value) return undefined;\n\t\tif (!this.se) return value;\n\t\tif (!this.se.multiple) return [this.se.selectedIndex];\n\t\tconst indexes: number[] = []; // FormControl for multiselect doesn't update when selected option is removed dynamically\n\t\tArray.from(this.se.options).forEach((o, i) => o.selected && indexes.push(i));\n\t\treturn indexes;\n\t}\n\n\t// =============================================================================================================================\n\tpublic isDisabled() {\n\t\treturn this.control.disabled;\n\t}\n}\n\n// =================================================================================================================================\n//\t\t\t\t\t\tS T O R E\n// =================================================================================================================================\nclass Store implements FmmStore {\n\tpublic namelessControls: FmmNgNamelessControls = {};\n\tprivate readonly listener: EventListener;\n\tprivate readonly minimaps: Set<FmmMinimap> = new Set();\n\n\t// =============================================================================================================================\n\tpublic constructor(private readonly formGroup: FormGroup) {\n\t\tthis.listener = () => this.minimaps.forEach(m => m.takeSnapshot());\n\t}\n\n\t// =============================================================================================================================\n\tpublic createStoreItem(e: HTMLElement, _: () => FmmStoreItem) {\n\t\tconst name = e.getAttribute('name') || e.id;\n\t\tconst control = name ? this.namelessControls[name] : undefined;\n\t\tif (control) return new StoreItem(e, this.listener, name, control);\n\t\tlet inFormArray = false;\n\t\tlet path: string;\n\t\tlet fc = e;\n\t\tfor (; fc && fc.tagName !== 'FORM'; fc = fc.parentElement) {\n\t\t\tpath = fc.getAttribute('formcontrolname') || fc.dataset.formcontrolname;\n\t\t\tif (path) break;\n\t\t\tinFormArray = fc.dataset.fmminformarray !== undefined;\n\t\t\tif (inFormArray) break;\n\t\t}\n\t\tfor (let p = fc?.parentElement; p && p.tagName !== 'FORM'; p = p.parentElement) {\n\t\t\tlet pName = p.getAttribute('formarrayname');\n\t\t\tif (!pName) {\n\t\t\t\tpName = p.getAttribute('formgroupname');\n\t\t\t\tif (pName) path = pName + '.' + path;\n\t\t\t} else if (!inFormArray) {\n\t\t\t\tpath = pName + '.' + path;\n\t\t\t} else {\n\t\t\t\tinFormArray = false;\n\t\t\t\tpath = pName;\n\t\t\t}\n\t\t}\n\t\tconst ac = this.formGroup.get(path);\n\t\treturn ac ? new StoreItem(e, this.listener, path, ac) : undefined;\n\t}\n\n\t// =============================================================================================================================\n\tpublic notifyMinimap(minimap: FmmMinimap, on: boolean) {\n\t\tif (on) this.minimaps.add(minimap);\n\t\telse this.minimaps.delete(minimap);\n\t}\n}\n","import { FmmFramework, FmmFrameworkItem } from '@eafmm/core';\n\n// =================================================================================================================================\n//\t\t\t\t\t\tF M M N G M A T E R I A L\n// =================================================================================================================================\nexport const FmmNgMaterial: FmmFramework = {\n\tcreateFrameworkItem(_: string, e: HTMLElement): FmmFrameworkItem {\n\t\tconst eTag = e.tagName;\n\t\tif (eTag === 'INPUT' && e.classList.contains('mat-autocomplete-trigger')) return new FrameworkItemAutoComplete(e);\n\t\treturn eTag === 'MAT-SELECT' ? new FrameworkItemSelect(e) : new FrameworkItem(e);\n\t}\n};\n\n// =================================================================================================================================\n// =================================================================================================================================\n// =================================================\tP R I V A T E\t============================================================\n// =================================================================================================================================\n// =================================================================================================================================\n\n// =================================================================================================================================\n//\t\t\t\t\t\tF R A M E W O R K I T E M\n// =================================================================================================================================\nclass FrameworkItem implements FmmFrameworkItem {\n\tprivate readonly envelope: HTMLElement;\n\tprivate readonly forValidation: HTMLElement;\n\tprivate readonly label: HTMLElement;\n\n\t// =============================================================================================================================\n\tpublic constructor(e: HTMLElement) {\n\t\tlet field = e.parentElement;\n\t\twhile (field && field.tagName !== 'MAT-FORM-FIELD') field = field.parentElement;\n\t\tlet tag = e;\n\t\twhile (tag && !tag.tagName.startsWith('MAT-')) tag = tag.parentElement;\n\t\tif (!field) {\n\t\t\tthis.envelope = this.forValidation = tag || e;\n\t\t} else {\n\t\t\tthis.forValidation = field;\n\t\t\tthis.envelope = !tag || field.querySelectorAll(tag.tagName).length < 2 ? field : tag || e;\n\t\t\tconst labels = field.querySelectorAll('LABEL');\n\t\t\tif (labels.length === 1) this.label = labels[0] as HTMLElement;\n\t\t}\n\t}\n\n\t// =============================================================================================================================\n\tpublic destructor() {\n\t\t/**/\n\t}\n\n\t// =============================================================================================================================\n\tpublic getEnvelope(_: string, _e: HTMLElement, _l: HTMLElement) {\n\t\treturn this.envelope;\n\t}\n\n\t// =============================================================================================================================\n\tpublic getError(_: string, _e: HTMLElement, _n: HTMLElement, _v: boolean) {\n\t\treturn this.forValidation.querySelector('MAT-ERROR')?.textContent;\n\t}\n\n\t// =============================================================================================================================\n\tpublic getLabel(_: string, _e: HTMLElement) {\n\t\treturn this.label;\n\t}\n\n\t// =============================================================================================================================\n\tpublic getValue(_: string, _e: HTMLElement, _n: HTMLElement, _l: string): string {\n\t\treturn undefined;\n\t}\n}\n\n// =================================================================================================================================\n//\t\t\t\t\t\tF R A M E W O R K I T E M A U T O C O M P L E T E\n// =================================================================================================================================\nclass FrameworkItemAutoComplete extends FrameworkItem {\n\t// =============================================================================================================================\n\tpublic getValue(_: string, e: HTMLElement, _n: HTMLElement, _l: string) {\n\t\treturn (e as HTMLInputElement).value;\n\t}\n}\n\n// =================================================================================================================================\n//\t\t\t\t\t\tF R A M E W O R K I T E M S E L E C T\n// =================================================================================================================================\nclass FrameworkItemSelect extends FrameworkItem {\n\t// =============================================================================================================================\n\tpublic getValue(_: string, e: HTMLElement, _n: HTMLElement, _l: string) {\n\t\treturn e.querySelector('.mat-select-value-text')?.textContent;\n\t}\n}\n","/**\n * Generated bundle index. Do not edit.\n */\n\nexport * from './public-api';\n"],"names":[],"mappings":"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"}