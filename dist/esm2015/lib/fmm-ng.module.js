import { Component, ElementRef, EventEmitter, Input, NgModule, Output } from '@angular/core';
import { Subscription } from 'rxjs';
import { Fmm } from '@eafmm/core';
// =================================================================================================================================
//						F M M N G M I N I M A P
// =================================================================================================================================
export class FmmNgMinimap {
    // =============================================================================================================================
    constructor(hostRef) {
        this.verbosity = 0;
        this.update = new EventEmitter();
        let form = hostRef.nativeElement;
        while (form && form.tagName !== 'FORM')
            form = form.parentElement;
        this.form = form;
    }
    // =============================================================================================================================
    destructor() {
        if (!this.minimap)
            return;
        this.minimap.destructor();
        this.minimap = undefined;
    }
    // =============================================================================================================================
    ngOnChanges() {
        if (!this.minimap)
            return;
        if (this.key !== this.previousKey) {
            this.minimap.destructor();
            this.ngOnInit();
        }
        else {
            this.store.namelessControls = this.namelessControls;
            this.minimap.compose(this.customWidgetIds);
        }
    }
    // =============================================================================================================================
    ngOnDestroy() {
        if (!this.minimap)
            return;
        this.minimap.detach();
        this.store = undefined;
    }
    // =============================================================================================================================
    ngOnInit() {
        var _a;
        const p = {
            aggregateLabels: this.aggregateLabels,
            anchor: this.anchor,
            debounceMsec: this.debounceMsec,
            dynamicLabels: this.dynamicLabels,
            form: this.form,
            framework: this.framework,
            onUpdate: (snapshot) => this.update.next(snapshot),
            page: this.page,
            store: this.store = new Store(this.formGroup),
            title: this.title,
            usePanelDetail: this.usePanelDetail !== undefined,
            useWidthToScale: this.useWidthToScale !== undefined,
            verbosity: this.verbosity,
            widgetFactories: this.widgetFactories
        };
        this.minimap = this.panel
            ? (_a = G.PANELMAP.get(this.panel)) === null || _a === void 0 ? void 0 : _a.createMinimap(p)
            : Fmm.createMinimap(p, this.parent, new ElementFactory(this.parent || this.anchor));
        this.previousKey = this.key;
        this.ngOnChanges();
    }
    // =============================================================================================================================
    takeSnapshot() {
        var _a;
        return (_a = this.minimap) === null || _a === void 0 ? void 0 : _a.takeSnapshot();
    }
}
FmmNgMinimap.decorators = [
    { type: Component, args: [{ selector: 'fmm-ng-minimap', template: '' },] }
];
FmmNgMinimap.ctorParameters = () => [
    { type: ElementRef }
];
FmmNgMinimap.propDecorators = {
    aggregateLabels: [{ type: Input }],
    anchor: [{ type: Input }],
    customWidgetIds: [{ type: Input }],
    debounceMsec: [{ type: Input }],
    dynamicLabels: [{ type: Input }],
    formGroup: [{ type: Input }],
    framework: [{ type: Input }],
    key: [{ type: Input }],
    namelessControls: [{ type: Input }],
    page: [{ type: Input }],
    panel: [{ type: Input }],
    parent: [{ type: Input }],
    title: [{ type: Input }],
    usePanelDetail: [{ type: Input }],
    useWidthToScale: [{ type: Input }],
    verbosity: [{ type: Input }],
    widgetFactories: [{ type: Input }],
    update: [{ type: Output }]
};
// =================================================================================================================================
//						F M M N G P A N E L
// =================================================================================================================================
export class FmmNgPanel {
    // =============================================================================================================================
    constructor(hostRef) {
        this.hostRef = hostRef;
        this.ef = new ElementFactory(hostRef.nativeElement);
    }
    // =============================================================================================================================
    ngOnDestroy() {
        this.minimapPanel.destructor();
        G.PANELMAP.delete(this);
        this.minimapPanel = undefined;
    }
    // =============================================================================================================================
    ngOnInit() {
        const host = this.hostRef.nativeElement;
        const vertical = this.vertical !== undefined;
        this.minimapPanel = Fmm.createPanel(host, this.detailParent, vertical, this.ef);
        G.PANELMAP.set(this, this.minimapPanel);
    }
    // =============================================================================================================================
    destroyDetached() {
        var _a;
        return (_a = this.minimapPanel) === null || _a === void 0 ? void 0 : _a.destroyDetached();
    }
}
FmmNgPanel.decorators = [
    { type: Component, args: [{ selector: 'fmm-ng-panel', template: '' },] }
];
FmmNgPanel.ctorParameters = () => [
    { type: ElementRef }
];
FmmNgPanel.propDecorators = {
    detailParent: [{ type: Input }],
    vertical: [{ type: Input }]
};
// =================================================================================================================================
//						F M M N G M O D U L E
// =================================================================================================================================
export class FmmNgModule {
}
FmmNgModule.decorators = [
    { type: NgModule, args: [{ declarations: [FmmNgMinimap, FmmNgPanel], exports: [FmmNgMinimap, FmmNgPanel] },] }
];
// =================================================================================================================================
// =================================================================================================================================
// =================================================	P R I V A T E	============================================================
// =================================================================================================================================
// =================================================================================================================================
// =================================================================================================================================
//						E L E M E N T F A C T O R Y
// =================================================================================================================================
class ElementFactory {
    // =============================================================================================================================
    constructor(p) {
        let ngContentAttribute; // set attribute on elements to use non-global CSS
        if (Element.prototype.getAttributeNames !== undefined) {
            for (; p && !ngContentAttribute; p = p.parentElement) {
                const names = p.getAttributeNames();
                ngContentAttribute = names.find((a) => a.startsWith('_ngcontent-'));
            }
        }
        else {
            for (; p && !ngContentAttribute; p = p.parentElement) {
                const names = Array.prototype.map.call(p.attributes, (a) => a.name);
                ngContentAttribute = names.find((a) => a.startsWith('_ngcontent-'));
            }
        }
        if (!ngContentAttribute)
            throw new Error('FormMinimap: missing _ngcontent- attribute');
        this.ngContentAttribute = ngContentAttribute;
    }
    // =============================================================================================================================
    createElement(tagName) {
        const e = document.createElement(tagName);
        e.setAttribute(this.ngContentAttribute, '');
        return e;
    }
    // =============================================================================================================================
    createElementNS(namespaceURI, qualifiedName) {
        const e = document.createElementNS(namespaceURI, qualifiedName);
        e.setAttribute(this.ngContentAttribute, '');
        return e;
    }
}
// =================================================================================================================================
//						G
// =================================================================================================================================
const G = {
    PANELMAP: new WeakMap()
};
// =================================================================================================================================
//						S T O R E I T E M
// =================================================================================================================================
class StoreItem {
    // =============================================================================================================================
    constructor(e, listener, name, control) {
        this.name = name;
        this.control = control;
        this.se = e.tagName === 'SELECT' ? e : undefined;
        const subscription = new Subscription();
        subscription.add(this.control.statusChanges.subscribe(listener));
        subscription.add(this.control.valueChanges.subscribe(listener));
        this.destructor = () => subscription.unsubscribe();
    }
    // =============================================================================================================================
    destructor() {
        // function body overwritten in constructor
    }
    // =============================================================================================================================
    getError(hasValue) {
        const errors = this.control.errors;
        let keys = errors ? Object.keys(errors) : [];
        if (hasValue && keys.length)
            keys = keys.filter(k => k !== 'required'); // IE11 SELECT bug
        return keys.length ? keys.join(',') : undefined;
    }
    // =============================================================================================================================
    getName() {
        return this.name;
    }
    // =============================================================================================================================
    getValue() {
        const value = this.control.value;
        if (!value)
            return undefined;
        if (!this.se)
            return value;
        if (!this.se.multiple)
            return [this.se.selectedIndex];
        const indexes = []; // FormControl for multiselect doesn't update when selected option is removed dynamically
        Array.from(this.se.options).forEach((o, i) => o.selected && indexes.push(i));
        return indexes;
    }
    // =============================================================================================================================
    isDisabled() {
        return this.control.disabled;
    }
}
// =================================================================================================================================
//						S T O R E
// =================================================================================================================================
class Store {
    // =============================================================================================================================
    constructor(formGroup) {
        this.formGroup = formGroup;
        this.namelessControls = {};
        this.minimaps = new Set();
        this.listener = () => this.minimaps.forEach(m => m.takeSnapshot());
    }
    // =============================================================================================================================
    createStoreItem(e, _) {
        const name = e.getAttribute('name') || e.id;
        const control = name ? this.namelessControls[name] : undefined;
        if (control)
            return new StoreItem(e, this.listener, name, control);
        let inFormArray = false;
        let path;
        let fc = e;
        for (; fc && fc.tagName !== 'FORM'; fc = fc.parentElement) {
            path = fc.getAttribute('formcontrolname') || fc.dataset.formcontrolname;
            if (path)
                break;
            inFormArray = fc.dataset.fmminformarray !== undefined;
            if (inFormArray)
                break;
        }
        for (let p = fc === null || fc === void 0 ? void 0 : fc.parentElement; p && p.tagName !== 'FORM'; p = p.parentElement) {
            let pName = p.getAttribute('formarrayname');
            if (!pName) {
                pName = p.getAttribute('formgroupname');
                if (pName)
                    path = pName + '.' + path;
            }
            else if (!inFormArray) {
                path = pName + '.' + path;
            }
            else {
                inFormArray = false;
                path = pName;
            }
        }
        const ac = this.formGroup.get(path);
        return ac ? new StoreItem(e, this.listener, path, ac) : undefined;
    }
    // =============================================================================================================================
    notifyMinimap(minimap, on) {
        if (on)
            this.minimaps.add(minimap);
        else
            this.minimaps.delete(minimap);
    }
}
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiZm1tLW5nLm1vZHVsZS5qcyIsInNvdXJjZVJvb3QiOiIiLCJzb3VyY2VzIjpbIi4uLy4uLy4uL3NyYy9saWIvZm1tLW5nLm1vZHVsZS50cyJdLCJuYW1lcyI6W10sIm1hcHBpbmdzIjoiQUFBQSxPQUFPLEVBQUUsU0FBUyxFQUFFLFVBQVUsRUFBRSxZQUFZLEVBQUUsS0FBSyxFQUFFLFFBQVEsRUFBZ0MsTUFBTSxFQUFFLE1BQU0sZUFBZSxDQUFDO0FBRTNILE9BQU8sRUFBRSxZQUFZLEVBQUUsTUFBTSxNQUFNLENBQUM7QUFDcEMsT0FBTyxFQUNOLEdBQUcsRUFXSCxNQUFNLGFBQWEsQ0FBQztBQUVyQixvSUFBb0k7QUFDcEksK0JBQStCO0FBQy9CLG9JQUFvSTtBQUVwSSxNQUFNLE9BQU8sWUFBWTtJQXlCeEIsZ0lBQWdJO0lBQ2hJLFlBQW1CLE9BQW1CO1FBVnRCLGNBQVMsR0FBRyxDQUFDLENBQUM7UUFFSixXQUFNLEdBQUcsSUFBSSxZQUFZLEVBQXNCLENBQUM7UUFTekUsSUFBSSxJQUFJLEdBQUcsT0FBTyxDQUFDLGFBQXdCLENBQUM7UUFDNUMsT0FBTyxJQUFJLElBQUksSUFBSSxDQUFDLE9BQU8sS0FBSyxNQUFNO1lBQUUsSUFBSSxHQUFHLElBQUksQ0FBQyxhQUFhLENBQUM7UUFDbEUsSUFBSSxDQUFDLElBQUksR0FBRyxJQUF1QixDQUFDO0lBQ3JDLENBQUM7SUFFRCxnSUFBZ0k7SUFDekgsVUFBVTtRQUNoQixJQUFJLENBQUMsSUFBSSxDQUFDLE9BQU87WUFBRSxPQUFPO1FBQzFCLElBQUksQ0FBQyxPQUFPLENBQUMsVUFBVSxFQUFFLENBQUM7UUFDMUIsSUFBSSxDQUFDLE9BQU8sR0FBRyxTQUFTLENBQUM7SUFDMUIsQ0FBQztJQUVELGdJQUFnSTtJQUN6SCxXQUFXO1FBQ2pCLElBQUksQ0FBQyxJQUFJLENBQUMsT0FBTztZQUFFLE9BQU87UUFDMUIsSUFBSSxJQUFJLENBQUMsR0FBRyxLQUFLLElBQUksQ0FBQyxXQUFXLEVBQUU7WUFDbEMsSUFB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O2dCQUNwQixJQUFJLEdBQUcsS0FBSyxDQUFDO2FBQ2I7U0FDRDtRQUNELE1BQU0sRUFBRSxHQUFHLElBQUksQ0FBQyxTQUFTLENBQUMsR0FBRyxDQUFDLElBQUksQ0FBQyxDQUFDO1FBQ3BDLE9BQU8sRUFBRSxDQUFDLENBQUMsQ0FBQyxJQUFJLFNBQVMsQ0FBQyxDQUFDLEVBQUUsSUFBSSxDQUFDLFFBQVEsRUFBRSxJQUFJLEVBQUUsRUFBRSxDQUFDLENBQUMsQ0FBQyxDQUFDLFNBQVMsQ0FBQztJQUNuRSxDQUFDO0lBRUQsZ0lBQWdJO0lBQ3pILGFBQWEsQ0FBQyxPQUFtQixFQUFFLEVBQVc7UUFDcEQsSUFBSSxFQUFFO1lBQUUsSUFBSSxDQUFDLFFBQVEsQ0FBQyxHQUFHLENBQUMsT0FBTyxDQUFDLENBQUM7O1lBQzlCLElBQUksQ0FBQyxRQUFRLENBQUMsTUFBTSxDQUFDLE9BQU8sQ0FBQyxDQUFDO0lBQ3BDLENBQUM7Q0FDRCIsInNvdXJjZXNDb250ZW50IjpbImltcG9ydCB7IENvbXBvbmVudCwgRWxlbWVudFJlZiwgRXZlbnRFbWl0dGVyLCBJbnB1dCwgTmdNb2R1bGUsIE9uQ2hhbmdlcywgT25EZXN0cm95LCBPbkluaXQsIE91dHB1dCB9IGZyb20gJ0Bhbmd1bGFyL2NvcmUnO1xuaW1wb3J0IHsgQWJzdHJhY3RDb250cm9sLCBGb3JtR3JvdXAgfSBmcm9tICdAYW5ndWxhci9mb3Jtcyc7XG5pbXBvcnQgeyBTdWJzY3JpcHRpb24gfSBmcm9tICdyeGpzJztcbmltcG9ydCB7XG5cdEZtbSxcblx0Rm1tRWxlbWVudEZhY3RvcnksXG5cdEZtbUZyYW1ld29yayxcblx0Rm1tTWFwU3RyaW5nLFxuXHRGbW1NaW5pbWFwLFxuXHRGbW1NaW5pbWFwQ3JlYXRlUGFyYW0sXG5cdEZtbU1pbmltYXBTbmFwc2hvdCxcblx0Rm1tUGFuZWwsXG5cdEZtbVN0b3JlLFxuXHRGbW1TdG9yZUl0ZW0sXG5cdEZtbVdpZGdldEZhY3Rvcnlcbn0gZnJvbSAnQGVhZm1tL2NvcmUnO1xuXG4vLyA9PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT1cbi8vXHRcdFx0XHRcdFx0RiBNIE0gTiBHIE0gSSBOIEkgTSBBIFBcbi8vID09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PVxuQENvbXBvbmVudCh7IHNlbGVjdG9yOiAnZm1tLW5nLW1pbmltYXAnLCB0ZW1wbGF0ZTogJycgfSlcbmV4cG9ydCBjbGFzcyBGbW1OZ01pbmltYXAgaW1wbGVtZW50cyBPbkNoYW5nZXMsIE9uRGVzdHJveSwgT25Jbml0LCBQYXJ0aWFsPEZtbU1pbmltYXA+IHtcblx0QElucHV0KCkgcHVibGljIGFnZ3JlZ2F0ZUxhYmVscz86IEZtbU1hcFN0cmluZztcblx0QElucHV0KCkgcHVibGljIGFuY2hvcjogSFRNTEVsZW1lbnQ7XG5cdEBJbnB1dCgpIHB1YmxpYyBjdXN0b21XaWRnZXRJZHM6IHN0cmluZ1tdO1xuXHRASW5wdXQoKSBwdWJsaWMgZGVib3VuY2VNc2VjOiBudW1iZXI7XG5cdEBJbnB1dCgpIHB1YmxpYyBkeW5hbWljTGFiZWxzPzogc3RyaW5nW107XG5cdEBJbnB1dCgpIHB1YmxpYyBmb3JtR3JvdXA6IEZvcm1Hcm91cDtcblx0QElucHV0KCkgcHVibGljIGZyYW1ld29yazogRm1tRnJhbWV3b3JrO1xuXHRASW5wdXQoKSBwdWJsaWMga2V5OiBzdHJpbmc7XG5cdEBJbnB1dCgpIHB1YmxpYyBuYW1lbGVzc0NvbnRyb2xzOiBGbW1OZ05hbWVsZXNzQ29udHJvbHM7XG5cdEBJbnB1dCgpIHB1YmxpYyBwYWdlOiBIVE1MRWxlbWVudDtcblx0QElucHV0KCkgcHVibGljIHBhbmVsOiBGbW1OZ1BhbmVsO1xuXHRASW5wdXQoKSBwdWJsaWMgcGFyZW50OiBIVE1MRWxlbWVudDtcblx0QElucHV0KCkgcHVibGljIHRpdGxlOiBzdHJpbmc7XG5cdEBJbnB1dCgpIHB1YmxpYyB1c2VQYW5lbERldGFpbDogYm9vbGVhbjtcblx0QElucHV0KCkgcHVibGljIHVzZVdpZHRoVG9TY2FsZTogYm9vbGVhbjtcblx0QElucHV0KCkgcHVibGljIHZlcmJvc2l0eSA9IDA7XG5cdEBJbnB1dCgpIHB1YmxpYyB3aWRnZXRGYWN0b3JpZXM/OiBGbW1XaWRnZXRGYWN0b3J5W107XG5cdEBPdXRwdXQoKSBwdWJsaWMgcmVhZG9ubHkgdXBkYXRlID0gbmV3IEV2ZW50RW1pdHRlcjxGbW1NaW5pbWFwU25hcHNob3Q+KCk7XG5cdHByaXZhdGUgcmVhZG9ubHkgZm9ybTogSFRNTEZvcm1FbGVtZW50O1xuXG5cdHByaXZhdGUgbWluaW1hcDogRm1tTWluaW1hcDtcblx0cHJpdmF0ZSBwcmV2aW91c0tleTogc3RyaW5nO1xuXHRwcml2YXRlIHN0b3JlOiBTdG9yZTtcblxuXHQvLyA9PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PVxuXHRwdWJsaWMgY29uc3RydWN0b3IoaG9zdFJlZjogRWxlbWVudFJlZikge1xuXHRcdGxldCBmb3JtID0gaG9zdFJlZi5uYXRpdmVFbGVtZW50IGFzIEVsZW1lbnQ7XG5cdFx0d2hpbGUgKGZvcm0gJiYgZm9ybS50YWdOYW1lICE9PSAnRk9STScpIGZvcm0gPSBmb3JtLnBhcmVudEVsZW1lbnQ7XG5cdFx0dGhpcy5mb3JtID0gZm9ybSBhcyBIVE1MRm9ybUVsZW1lbnQ7XG5cdH1cblxuXHQvLyA9PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PVxuXHRwdWJsaWMgZGVzdHJ1Y3RvcigpOiB2b2lkIHtcblx0XHRpZiAoIXRoaXMubWluaW1hcCkgcmV0dXJuO1xuXHRcdHRoaXMubWluaW1hcC5kZXN0cnVjdG9yKCk7XG5cdFx0dGhpcy5taW5pbWFwID0gdW5kZWZpbmVkO1xuXHR9XG5cblx0Ly8gPT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT1cblx0cHVibGljIG5nT25DaGFuZ2VzKCk6IHZvaWQge1xuXHRcdGlmICghdGhpcy5taW5pbWFwKSByZXR1cm47XG5cdFx0aWYgKHRoaXMua2V5ICE9PSB0aGlzLnByZXZpb3VzS2V5KSB7XG5cdFx0XHR0aGlzLm1pbmltYXAuZGVzdHJ1Y3RvcigpO1xuXHRcdFx0dGhpcy5uZ09uSW5pdCgpO1xuXHRcdH0gZWxzZSB7XG5cdFx0XHR0aGlzLnN0b3JlLm5hbWVsZXNzQ29udHJvbHMgPSB0aGlzLm5hbWVsZXNzQ29udHJvbHM7XG5cdFx0XHR0aGlzLm1pbmltYXAuY29tcG9zZSh0aGlzLmN1c3RvbVdpZGdldElkcyk7XHRcblx0XHR9XG5cdH1cblxuXHQvLyA9PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PVxuXHRwdWJsaWMgbmdPbkRlc3Ryb3koKTogdm9pZCB7XG5cdFx0aWYgKCF0aGlzLm1pbmltYXApIHJldHVybjtcblx0XHR0aGlzLm1pbmltYXAuZGV0YWNoKCk7XG5cdFx0dGhpcy5zdG9yZSA9IHVuZGVmaW5lZDtcblx0fVxuXG5cdC8vID09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09XG5cdHB1YmxpYyBuZ09uSW5pdCgpOiB2b2lkIHtcblx0XHRjb25zdCBwOiBGbW1NaW5pbWFwQ3JlYXRlUGFyYW0gPSB7XG5cdFx0XHRhZ2dyZWdhdGVMYWJlbHM6IHRoaXMuYWdncmVnYXRlTGFiZWxzLFxuXHRcdFx0YW5jaG9yOiB0aGlzLmFuY2hvcixcblx0XHRcdGRlYm91bmNlTXNlYzogdGhpcy5kZWJvdW5jZU1zZWMsXG5cdFx0XHRkeW5hbWljTGFiZWxzOiB0aGlzLmR5bmFtaWNMYWJlbHMsXG5cdFx0XHRmb3JtOiB0aGlzLmZvcm0sXG5cdFx0XHRmcmFtZXdvcms6IHRoaXMuZnJhbWV3b3JrLFxuXHRcdFx0b25VcGRhdGU6IChzbmFwc2hvdDogRm1tTWluaW1hcFNuYXBzaG90KSA9PiB0aGlzLnVwZGF0ZS5uZXh0KHNuYXBzaG90KSxcblx0XHRcdHBhZ2U6IHRoaXMucGFnZSxcblx0XHRcdHN0b3JlOiB0aGlzLnN0b3JlID0gbmV3IFN0b3JlKHRoaXMuZm9ybUdyb3VwKSxcblx0XHRcdHRpdGxlOiB0aGlzLnRpdGxlLFxuXHRcdFx0dXNlUGFuZWxEZXRhaWw6IHRoaXMudXNlUGFuZWxEZXRhaWwgIT09IHVuZGVmaW5lZCxcblx0XHRcdHVzZVdpZHRoVG9TY2FsZTogdGhpcy51c2VXaWR0aFRvU2NhbGUgIT09IHVuZGVmaW5lZCxcblx0XHRcdHZlcmJvc2l0eTogdGhpcy52ZXJib3NpdHksXG5cdFx0XHR3aWRnZXRGYWN0b3JpZXM6IHRoaXMud2lkZ2V0RmFjdG9yaWVzXG5cdFx0fTtcblx0XHR0aGlzLm1pbmltYXAgPSB0aGlzLnBhbmVsXG5cdFx0XHQ/IEcuUEFORUxNQVAuZ2V0KHRoaXMucGFuZWwpPy5jcmVhdGVNaW5pbWFwKHApXG5cdFx0XHQ6IEZtbS5jcmVhdGVNaW5pbWFwKHAsIHRoaXMucGFyZW50LCBuZXcgRWxlbWVudEZhY3RvcnkodGhpcy5wYXJlbnQgfHwgdGhpcy5hbmNob3IpKTtcblx0XHR0aGlzLnByZXZpb3VzS2V5ID0gdGhpcy5rZXk7XG5cdFx0dGhpcy5uZ09uQ2hhbmdlcygpO1xuXHR9XG5cblx0Ly8gPT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT1cblx0cHVibGljIHRha2VTbmFwc2hvdCgpOiBib29sZWFuIHtcblx0XHRyZXR1cm4gdGhpcy5taW5pbWFwPy50YWtlU25hcHNob3QoKTtcblx0fVxufVxuXG4vLyA9PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT1cbi8vXHRcdFx0XHRcdFx0RiBNIE0gTiBHIFAgQSBOIEUgTFxuLy8gPT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09XG5AQ29tcG9uZW50KHsgc2VsZWN0b3I6ICdmbW0tbmctcGFuZWwnLCB0ZW1wbGF0ZTogJycgfSlcbmV4cG9ydCBjbGFzcyBGbW1OZ1BhbmVsIGltcGxlbWVudHMgT25EZXN0cm95LCBPbkluaXQsIFBhcnRpYWw8Rm1tUGFuZWw+IHtcblx0QElucHV0KCkgcHVibGljIHJlYWRvbmx5IGRldGFpbFBhcmVudDogSFRNTEVsZW1lbnQ7XG5cdEBJbnB1dCgpIHB1YmxpYyByZWFkb25seSB2ZXJ0aWNhbDogYm9vbGVhbjtcblxuXHRwdWJsaWMgcmVhZG9ubHkgZWY6IEZtbUVsZW1lbnRGYWN0b3J5O1xuXHRwcml2YXRlIG1pbmltYXBQYW5lbDogRm1tUGFuZWw7XG5cblx0Ly8gPT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT1cblx0cHVibGljIGNvbnN0cnVjdG9yKHByaXZhdGUgcmVhZG9ubHkgaG9zdFJlZjogRWxlbWVudFJlZikge1xuXHRcdHRoaXMuZWYgPSBuZXcgRWxlbWVudEZhY3RvcnkoaG9zdFJlZi5uYXRpdmVFbGVtZW50IGFzIEVsZW1lbnQpO1xuXHR9XG5cblx0Ly8gPT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT1cblx0cHVibGljIG5nT25EZXN0cm95KCk6IHZvaWQge1xuXHRcdHRoaXMubWluaW1hcFBhbmVsLmRlc3RydWN0b3IoKTtcblx0XHRHLlBBTkVMTUFQLmRlbGV0ZSh0aGlzKTtcblx0XHR0aGlzLm1pbmltYXBQYW5lbCA9IHVuZGVmaW5lZDtcblx0fVxuXG5cdC8vID09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09XG5cdHB1YmxpYyBuZ09uSW5pdCgpOiB2b2lkIHtcblx0XHRjb25zdCBob3N0ID0gdGhpcy5ob3N0UmVmLm5hdGl2ZUVsZW1lbnQgYXMgSFRNTEVsZW1lbnQ7XG5cdFx0Y29uc3QgdmVydGljYWwgPSB0aGlzLnZlcnRpY2FsICE9PSB1bmRlZmluZWQ7XG5cdFx0dGhpcy5taW5pbWFwUGFuZWwgPSBGbW0uY3JlYXRlUGFuZWwoaG9zdCwgdGhpcy5kZXRhaWxQYXJlbnQsIHZlcnRpY2FsLCB0aGlzLmVmKTtcblx0XHRHLlBBTkVMTUFQLnNldCh0aGlzLCB0aGlzLm1pbmltYXBQYW5lbCk7XG5cdH1cblxuXHQvLyA9PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PVxuXHRwdWJsaWMgZGVzdHJveURldGFjaGVkKCk6IHZvaWQge1xuXHRcdHJldHVybiB0aGlzLm1pbmltYXBQYW5lbD8uZGVzdHJveURldGFjaGVkKCk7XG5cdH1cbn1cblxuLy8gPT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09XG4vL1x0XHRcdFx0XHRcdEYgTSBNIE4gRyBNIE8gRCBVIEwgRVxuLy8gPT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09XG5ATmdNb2R1bGUoeyBkZWNsYXJhdGlvbnM6IFtGbW1OZ01pbmltYXAsIEZtbU5nUGFuZWxdLCBleHBvcnRzOiBbRm1tTmdNaW5pbWFwLCBGbW1OZ1BhbmVsXSB9KVxuZXhwb3J0IGNsYXNzIEZtbU5nTW9kdWxlIHt9XG5cbi8vID09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PVxuLy9cdFx0XHRcdFx0XHRGIE0gTSBOIEcgTiBBIE0gRSBMIEUgUyBTIEMgTyBOIFQgUiBPIEwgU1xuLy8gPT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09XG5leHBvcnQgdHlwZSBGbW1OZ05hbWVsZXNzQ29udHJvbHMgPSBSZWNvcmQ8c3RyaW5nLCBBYnN0cmFjdENvbnRyb2w+O1xuXG4vLyA9PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT1cbi8vID09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PVxuLy8gPT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PVx0UCBSIEkgViBBIFQgRVx0PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09XG4vLyA9PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT1cbi8vID09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PVxuXG4vLyA9PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT1cbi8vXHRcdFx0XHRcdFx0RSBMIEUgTSBFIE4gVCBGIEEgQyBUIE8gUiBZXG4vLyA9PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT1cbmNsYXNzIEVsZW1lbnRGYWN0b3J5IGltcGxlbWVudHMgRm1tRWxlbWVudEZhY3Rvcnkge1xuXHRwcml2YXRlIHJlYWRvbmx5IG5nQ29udGVudEF0dHJpYnV0ZTogc3RyaW5nO1xuXG5cdC8vID09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09XG5cdHB1YmxpYyBjb25zdHJ1Y3RvcihwOiBFbGVtZW50KSB7XG5cdFx0bGV0IG5nQ29udGVudEF0dHJpYnV0ZTogc3RyaW5nOyAvLyBzZXQgYXR0cmlidXRlIG9uIGVsZW1lbnRzIHRvIHVzZSBub24tZ2xvYmFsIENTU1xuXHRcdGlmIChFbGVtZW50LnByb3RvdHlwZS5nZXRBdHRyaWJ1dGVOYW1lcyAhPT0gdW5kZWZpbmVkKSB7XG5cdFx0XHRmb3IgKDsgcCAmJiAhbmdDb250ZW50QXR0cmlidXRlOyBwID0gcC5wYXJlbnRFbGVtZW50KSB7XG5cdFx0XHRcdGNvbnN0IG5hbWVzID0gcC5nZXRBdHRyaWJ1dGVOYW1lcygpO1xuXHRcdFx0XHRuZ0NvbnRlbnRBdHRyaWJ1dGUgPSBuYW1lcy5maW5kKChhOiBzdHJpbmcpID0+IGEuc3RhcnRzV2l0aCgnX25nY29udGVudC0nKSk7XG5cdFx0XHR9XG5cdFx0fSBlbHNlIHtcblx0XHRcdGZvciAoOyBwICYmICFuZ0NvbnRlbnRBdHRyaWJ1dGU7IHAgPSBwLnBhcmVudEVsZW1lbnQpIHtcblx0XHRcdFx0Y29uc3QgbmFtZXMgPSBBcnJheS5wcm90b3R5cGUubWFwLmNhbGwocC5hdHRyaWJ1dGVzLCAoYTogQXR0cikgPT4gYS5uYW1lKSBhcyBzdHJpbmdbXTtcblx0XHRcdFx0bmdDb250ZW50QXR0cmlidXRlID0gbmFtZXMuZmluZCgoYTogc3RyaW5nKSA9PiBhLnN0YXJ0c1dpdGgoJ19uZ2NvbnRlbnQtJykpO1xuXHRcdFx0fVxuXHRcdH1cblx0XHRpZiAoIW5nQ29udGVudEF0dHJpYnV0ZSkgdGhyb3cgbmV3IEVycm9yKCdGb3JtTWluaW1hcDogbWlzc2luZyBfbmdjb250ZW50LSBhdHRyaWJ1dGUnKTtcblx0XHR0aGlzLm5nQ29udGVudEF0dHJpYnV0ZSA9IG5nQ29udGVudEF0dHJpYnV0ZTtcblx0fVxuXG5cdC8vID09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09XG5cdHB1YmxpYyBjcmVhdGVFbGVtZW50KHRhZ05hbWU6IHN0cmluZykge1xuXHRcdGNvbnN0IGUgPSBkb2N1bWVudC5jcmVhdGVFbGVtZW50KHRhZ05hbWUpO1xuXHRcdGUuc2V0QXR0cmlidXRlKHRoaXMubmdDb250ZW50QXR0cmlidXRlLCAnJyk7XG5cdFx0cmV0dXJuIGU7XG5cdH1cblxuXHQvLyA9PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PVxuXHRwdWJsaWMgY3JlYXRlRWxlbWVudE5TKG5hbWVzcGFjZVVSSTogc3RyaW5nLCBxdWFsaWZpZWROYW1lOiBzdHJpbmcpIHtcblx0XHRjb25zdCBlID0gZG9jdW1lbnQuY3JlYXRlRWxlbWVudE5TKG5hbWVzcGFjZVVSSSwgcXVhbGlmaWVkTmFtZSk7XG5cdFx0ZS5zZXRBdHRyaWJ1dGUodGhpcy5uZ0NvbnRlbnRBdHRyaWJ1dGUsICcnKTtcblx0XHRyZXR1cm4gZTtcblx0fVxufVxuXG4vLyA9PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT1cbi8vXHRcdFx0XHRcdFx0R1xuLy8gPT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09XG5jb25zdCBHOiB7XG5cdFBBTkVMTUFQOiBXZWFrTWFwPEZtbU5nUGFuZWwsIEZtbVBhbmVsPjtcbn0gPSB7XG5cdFBBTkVMTUFQOiBuZXcgV2Vha01hcCgpXG59O1xuXG4vLyA9PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT1cbi8vXHRcdFx0XHRcdFx0UyBUIE8gUiBFIEkgVCBFIE1cbi8vID09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PVxuY2xhc3MgU3RvcmVJdGVtIGltcGxlbWVudHMgRm1tU3RvcmVJdGVtIHtcblx0cHJpdmF0ZSByZWFkb25seSBzZTogSFRNTFNlbGVjdEVsZW1lbnQ7XG5cblx0Ly8gPT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT1cblx0cHVibGljIGNvbnN0cnVjdG9yKFxuXHRcdGU6IEhUTUxFbGVtZW50LFxuXHRcdGxpc3RlbmVyOiBFdmVudExpc3RlbmVyLFxuXHRcdHByaXZhdGUgcmVhZG9ubHkgbmFtZTogc3RyaW5nLFxuXHRcdHByaXZhdGUgcmVhZG9ubHkgY29udHJvbDogQWJzdHJhY3RDb250cm9sXG5cdCkge1xuXHRcdHRoaXMuc2UgPSBlLnRhZ05hbWUgPT09ICdTRUxFQ1QnID8gKGUgYXMgSFRNTFNlbGVjdEVsZW1lbnQpIDogdW5kZWZpbmVkO1xuXHRcdGNvbnN0IHN1YnNjcmlwdGlvbiA9IG5ldyBTdWJzY3JpcHRpb24oKTtcblx0XHRzdWJzY3JpcHRpb24uYWRkKHRoaXMuY29udHJvbC5zdGF0dXNDaGFuZ2VzLnN1YnNjcmliZShsaXN0ZW5lcikpO1xuXHRcdHN1YnNjcmlwdGlvbi5hZGQodGhpcy5jb250cm9sLnZhbHVlQ2hhbmdlcy5zdWJzY3JpYmUobGlzdGVuZXIpKTtcblx0XHR0aGlzLmRlc3RydWN0b3IgPSAoKSA9PiBzdWJzY3JpcHRpb24udW5zdWJzY3JpYmUoKTtcblx0fVxuXG5cdC8vID09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09XG5cdHB1YmxpYyBkZXN0cnVjdG9yKCk6IHZvaWQge1xuXHRcdC8vIGZ1bmN0aW9uIGJvZHkgb3ZlcndyaXR0ZW4gaW4gY29uc3RydWN0b3Jcblx0fVxuXG5cdC8vID09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09XG5cdHB1YmxpYyBnZXRFcnJvcihoYXNWYWx1ZTogYm9vbGVhbik6IHN0cmluZyB7XG5cdFx0Y29uc3QgZXJyb3JzID0gdGhpcy5jb250cm9sLmVycm9ycztcblx0XHRsZXQga2V5cyA9IGVycm9ycyA/IE9iamVjdC5rZXlzKGVycm9ycykgOiBbXTtcblx0XHRpZiAoaGFzVmFsdWUgJiYga2V5cy5sZW5ndGgpIGtleXMgPSBrZXlzLmZpbHRlcihrID0+IGsgIT09ICdyZXF1aXJlZCcpOyAvLyBJRTExIFNFTEVDVCBidWdcblx0XHRyZXR1cm4ga2V5cy5sZW5ndGggPyBrZXlzLmpvaW4oJywnKSA6IHVuZGVmaW5lZDtcblx0fVxuXG5cdC8vID09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09XG5cdHB1YmxpYyBnZXROYW1lKCk6IHN0cmluZyB7XG5cdFx0cmV0dXJuIHRoaXMubmFtZTtcblx0fVxuXG5cdC8vID09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09XG5cdHB1YmxpYyBnZXRWYWx1ZSgpIHtcblx0XHRjb25zdCB2YWx1ZSA9IHRoaXMuY29udHJvbC52YWx1ZSBhcyB1bmtub3duO1xuXHRcdGlmICghdmFsdWUpIHJldHVybiB1bmRlZmluZWQ7XG5cdFx0aWYgKCF0aGlzLnNlKSByZXR1cm4gdmFsdWU7XG5cdFx0aWYgKCF0aGlzLnNlLm11bHRpcGxlKSByZXR1cm4gW3RoaXMuc2Uuc2VsZWN0ZWRJbmRleF07XG5cdFx0Y29uc3QgaW5kZXhlczogbnVtYmVyW10gPSBbXTsgLy8gRm9ybUNvbnRyb2wgZm9yIG11bHRpc2VsZWN0IGRvZXNuJ3QgdXBkYXRlIHdoZW4gc2VsZWN0ZWQgb3B0aW9uIGlzIHJlbW92ZWQgZHluYW1pY2FsbHlcblx0XHRBcnJheS5mcm9tKHRoaXMuc2Uub3B0aW9ucykuZm9yRWFjaCgobywgaSkgPT4gby5zZWxlY3RlZCAmJiBpbmRleGVzLnB1c2goaSkpO1xuXHRcdHJldHVybiBpbmRleGVzO1xuXHR9XG5cblx0Ly8gPT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT1cblx0cHVibGljIGlzRGlzYWJsZWQoKSB7XG5cdFx0cmV0dXJuIHRoaXMuY29udHJvbC5kaXNhYmxlZDtcblx0fVxufVxuXG4vLyA9PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT1cbi8vXHRcdFx0XHRcdFx0UyBUIE8gUiBFXG4vLyA9PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT1cbmNsYXNzIFN0b3JlIGltcGxlbWVudHMgRm1tU3RvcmUge1xuXHRwdWJsaWMgbmFtZWxlc3NDb250cm9sczogRm1tTmdOYW1lbGVzc0NvbnRyb2xzID0ge307XG5cdHByaXZhdGUgcmVhZG9ubHkgbGlzdGVuZXI6IEV2ZW50TGlzdGVuZXI7XG5cdHByaXZhdGUgcmVhZG9ubHkgbWluaW1hcHM6IFNldDxGbW1NaW5pbWFwPiA9IG5ldyBTZXQoKTtcblxuXHQvLyA9PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PVxuXHRwdWJsaWMgY29uc3RydWN0b3IocHJpdmF0ZSByZWFkb25seSBmb3JtR3JvdXA6IEZvcm1Hcm91cCkge1xuXHRcdHRoaXMubGlzdGVuZXIgPSAoKSA9PiB0aGlzLm1pbmltYXBzLmZvckVhY2gobSA9PiBtLnRha2VTbmFwc2hvdCgpKTtcblx0fVxuXG5cdC8vID09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09XG5cdHB1YmxpYyBjcmVhdGVTdG9yZUl0ZW0oZTogSFRNTEVsZW1lbnQsIF86ICgpID0+IEZtbVN0b3JlSXRlbSkge1xuXHRcdGNvbnN0IG5hbWUgPSBlLmdldEF0dHJpYnV0ZSgnbmFtZScpIHx8IGUuaWQ7XG5cdFx0Y29uc3QgY29udHJvbCA9IG5hbWUgPyB0aGlzLm5hbWVsZXNzQ29udHJvbHNbbmFtZV0gOiB1bmRlZmluZWQ7XG5cdFx0aWYgKGNvbnRyb2wpIHJldHVybiBuZXcgU3RvcmVJdGVtKGUsIHRoaXMubGlzdGVuZXIsIG5hbWUsIGNvbnRyb2wpO1xuXHRcdGxldCBpbkZvcm1BcnJheSA9IGZhbHNlO1xuXHRcdGxldCBwYXRoOiBzdHJpbmc7XG5cdFx0bGV0IGZjID0gZTtcblx0XHRmb3IgKDsgZmMgJiYgZmMudGFnTmFtZSAhPT0gJ0ZPUk0nOyBmYyA9IGZjLnBhcmVudEVsZW1lbnQpIHtcblx0XHRcdHBhdGggPSBmYy5nZXRBdHRyaWJ1dGUoJ2Zvcm1jb250cm9sbmFtZScpIHx8IGZjLmRhdGFzZXQuZm9ybWNvbnRyb2xuYW1lO1xuXHRcdFx0aWYgKHBhdGgpIGJyZWFrO1xuXHRcdFx0aW5Gb3JtQXJyYXkgPSBmYy5kYXRhc2V0LmZtbWluZm9ybWFycmF5ICE9PSB1bmRlZmluZWQ7XG5cdFx0XHRpZiAoaW5Gb3JtQXJyYXkpIGJyZWFrO1xuXHRcdH1cblx0XHRmb3IgKGxldCBwID0gZmM/LnBhcmVudEVsZW1lbnQ7IHAgJiYgcC50YWdOYW1lICE9PSAnRk9STSc7IHAgPSBwLnBhcmVudEVsZW1lbnQpIHtcblx0XHRcdGxldCBwTmFtZSA9IHAuZ2V0QXR0cmlidXRlKCdmb3JtYXJyYXluYW1lJyk7XG5cdFx0XHRpZiAoIXBOYW1lKSB7XG5cdFx0XHRcdHBOYW1lID0gcC5nZXRBdHRyaWJ1dGUoJ2Zvcm1ncm91cG5hbWUnKTtcblx0XHRcdFx0aWYgKHBOYW1lKSBwYXRoID0gcE5hbWUgKyAnLicgKyBwYXRoO1xuXHRcdFx0fSBlbHNlIGlmICghaW5Gb3JtQXJyYXkpIHtcblx0XHRcdFx0cGF0aCA9IHBOYW1lICsgJy4nICsgcGF0aDtcblx0XHRcdH0gZWxzZSB7XG5cdFx0XHRcdGluRm9ybUFycmF5ID0gZmFsc2U7XG5cdFx0XHRcdHBhdGggPSBwTmFtZTtcblx0XHRcdH1cblx0XHR9XG5cdFx0Y29uc3QgYWMgPSB0aGlzLmZvcm1Hcm91cC5nZXQocGF0aCk7XG5cdFx0cmV0dXJuIGFjID8gbmV3IFN0b3JlSXRlbShlLCB0aGlzLmxpc3RlbmVyLCBwYXRoLCBhYykgOiB1bmRlZmluZWQ7XG5cdH1cblxuXHQvLyA9PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PVxuXHRwdWJsaWMgbm90aWZ5TWluaW1hcChtaW5pbWFwOiBGbW1NaW5pbWFwLCBvbjogYm9vbGVhbikge1xuXHRcdGlmIChvbikgdGhpcy5taW5pbWFwcy5hZGQobWluaW1hcCk7XG5cdFx0ZWxzZSB0aGlzLm1pbmltYXBzLmRlbGV0ZShtaW5pbWFwKTtcblx0fVxufVxuIl19