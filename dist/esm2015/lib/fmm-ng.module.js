import { Component, ElementRef, EventEmitter, Input, NgModule, Output } from '@angular/core';
import { Subscription } from 'rxjs';
import { Fmm } from '@fmmp/core';
// =================================================================================================================================
//						F M M N G M I N I M A P
// =================================================================================================================================
export class FmmNgMinimap {
    // =============================================================================================================================
    constructor(hostRef) {
        this.verbosity = 0;
        this.update = new EventEmitter();
        let form = hostRef.nativeElement;
        while (form && form.tagName !== 'FORM')
            form = form.parentElement;
        this.form = form;
    }
    // =============================================================================================================================
    ngOnChanges() {
        if (!this.minimap)
            return;
        if (this.key !== this.previousKey) {
            this.minimap.destructor();
            this.ngOnInit();
        }
        else {
            this.store.namelessControls = this.namelessControls;
            this.minimap.compose(this.customWidgetIds);
        }
    }
    // =============================================================================================================================
    ngOnDestroy() {
        if (!this.minimap)
            return;
        this.minimap.detach();
        this.store = undefined;
    }
    // =============================================================================================================================
    ngOnInit() {
        const p = {
            aggregateLabels: this.aggregateLabels,
            anchor: this.anchor,
            debounceMsec: this.debounceMsec,
            dynamicLabels: this.dynamicLabels,
            form: this.form,
            framework: this.framework,
            onUpdate: (snapshot) => this.update.next(snapshot),
            page: this.page,
            store: this.store = new Store(this.formGroup),
            title: this.title,
            usePanelDetail: this.usePanelDetail !== undefined,
            useWidthToScale: this.useWidthToScale !== undefined,
            verbosity: this.verbosity,
            widgetFactories: this.widgetFactories
        };
        const panel = this.panel ? G.PANELMAP.get(this.panel) : undefined;
        this.minimap = panel === null || panel === void 0 ? void 0 : panel.createMinimap(p);
        this.previousKey = this.key;
        this.ngOnChanges();
    }
    // =============================================================================================================================
    takeSnapshot() {
        var _a;
        return (_a = this.minimap) === null || _a === void 0 ? void 0 : _a.takeSnapshot();
    }
}
FmmNgMinimap.decorators = [
    { type: Component, args: [{ selector: 'fmm-ng-minimap', template: '' },] }
];
FmmNgMinimap.ctorParameters = () => [
    { type: ElementRef }
];
FmmNgMinimap.propDecorators = {
    aggregateLabels: [{ type: Input }],
    anchor: [{ type: Input }],
    customWidgetIds: [{ type: Input }],
    debounceMsec: [{ type: Input }],
    dynamicLabels: [{ type: Input }],
    formGroup: [{ type: Input }],
    framework: [{ type: Input }],
    key: [{ type: Input }],
    namelessControls: [{ type: Input }],
    page: [{ type: Input }],
    panel: [{ type: Input }],
    title: [{ type: Input }],
    usePanelDetail: [{ type: Input }],
    useWidthToScale: [{ type: Input }],
    verbosity: [{ type: Input }],
    widgetFactories: [{ type: Input }],
    update: [{ type: Output }]
};
// =================================================================================================================================
//						F M M N G P A N E L
// =================================================================================================================================
export class FmmNgPanel {
    // =============================================================================================================================
    constructor(hostRef) {
        this.hostRef = hostRef;
        this.ef = new ElementFactory(hostRef);
    }
    // =============================================================================================================================
    ngOnDestroy() {
        this.minimapPanel.destructor();
        G.PANELMAP.delete(this);
        this.minimapPanel = undefined;
    }
    // =============================================================================================================================
    ngOnInit() {
        const host = this.hostRef.nativeElement;
        const vertical = this.vertical !== undefined;
        this.minimapPanel = Fmm.createPanel(this.ef, host, this.detailParent, vertical);
        G.PANELMAP.set(this, this.minimapPanel);
    }
    // =============================================================================================================================
    destroyDetached() {
        var _a;
        return (_a = this.minimapPanel) === null || _a === void 0 ? void 0 : _a.destroyDetached();
    }
}
FmmNgPanel.decorators = [
    { type: Component, args: [{ selector: 'fmm-ng-panel', template: '' },] }
];
FmmNgPanel.ctorParameters = () => [
    { type: ElementRef }
];
FmmNgPanel.propDecorators = {
    detailParent: [{ type: Input }],
    vertical: [{ type: Input }]
};
// =================================================================================================================================
//						F M M N G M O D U L E
// =================================================================================================================================
export class FmmNgModule {
}
FmmNgModule.decorators = [
    { type: NgModule, args: [{ declarations: [FmmNgMinimap, FmmNgPanel], exports: [FmmNgMinimap, FmmNgPanel] },] }
];
// =================================================================================================================================
// =================================================================================================================================
// =================================================	P R I V A T E	============================================================
// =================================================================================================================================
// =================================================================================================================================
// =================================================================================================================================
//						E L E M E N T F A C T O R Y
// =================================================================================================================================
class ElementFactory {
    // =============================================================================================================================
    constructor(ref) {
        let ngContentAttribute; // set attribute on elements to use non-global CSS
        if (Element.prototype.getAttributeNames !== undefined) {
            for (let p = ref.nativeElement; p && !ngContentAttribute; p = p.parentElement) {
                const names = p.getAttributeNames();
                ngContentAttribute = names.find((a) => a.startsWith('_ngcontent-'));
            }
        }
        else {
            for (let p = ref.nativeElement; p && !ngContentAttribute; p = p.parentElement) {
                const names = Array.prototype.map.call(p.attributes, (a) => a.name);
                ngContentAttribute = names.find((a) => a.startsWith('_ngcontent-'));
            }
        }
        if (!ngContentAttribute)
            throw new Error('FormMinimap: missing _ngcontent- attribute');
        this.ngContentAttribute = ngContentAttribute;
    }
    // =============================================================================================================================
    createElement(tagName) {
        const e = document.createElement(tagName);
        e.setAttribute(this.ngContentAttribute, '');
        return e;
    }
    // =============================================================================================================================
    createElementNS(namespaceURI, qualifiedName) {
        const e = document.createElementNS(namespaceURI, qualifiedName);
        e.setAttribute(this.ngContentAttribute, '');
        return e;
    }
}
// =================================================================================================================================
//						G
// =================================================================================================================================
const G = {
    PANELMAP: new WeakMap()
};
// =================================================================================================================================
//						S T O R E I T E M
// =================================================================================================================================
class StoreItem {
    // =============================================================================================================================
    constructor(e, listener, name, control) {
        this.name = name;
        this.control = control;
        this.se = e.tagName === 'SELECT' ? e : undefined;
        const subscription = new Subscription();
        subscription.add(this.control.statusChanges.subscribe(listener));
        subscription.add(this.control.valueChanges.subscribe(listener));
        this.destructor = () => subscription.unsubscribe();
    }
    // =============================================================================================================================
    destructor() {
        // function body overwritten in constructor
    }
    // =============================================================================================================================
    getError(hasValue) {
        const errors = this.control.errors;
        let keys = errors ? Object.keys(errors) : [];
        if (hasValue && keys.length)
            keys = keys.filter(k => k !== 'required'); // IE11 SELECT bug
        return keys.length ? keys.join(',') : undefined;
    }
    // =============================================================================================================================
    getName() {
        return this.name;
    }
    // =============================================================================================================================
    getValue() {
        const value = this.control.value;
        if (!value)
            return undefined;
        if (!this.se)
            return value;
        if (!this.se.multiple)
            return [this.se.selectedIndex];
        const indexes = []; // FormControl for multiselect doesn't update when selected option is removed dynamically
        Array.from(this.se.options).forEach((o, i) => o.selected && indexes.push(i));
        return indexes;
    }
    // =============================================================================================================================
    isDisabled() {
        return this.control.disabled;
    }
}
// =================================================================================================================================
//						S T O R E
// =================================================================================================================================
class Store {
    // =============================================================================================================================
    constructor(formGroup) {
        this.formGroup = formGroup;
        this.namelessControls = {};
        this.minimaps = new Set();
        this.listener = () => this.minimaps.forEach(m => m.takeSnapshot());
    }
    // =============================================================================================================================
    createStoreItem(e, _) {
        const name = e.getAttribute('name') || e.id;
        const control = name ? this.namelessControls[name] : undefined;
        if (control)
            return new StoreItem(e, this.listener, name, control);
        let inFormArray = false;
        let path;
        let fc = e;
        for (; fc && fc.tagName !== 'FORM'; fc = fc.parentElement) {
            path = fc.getAttribute('formcontrolname') || fc.dataset.formcontrolname;
            if (path)
                break;
            inFormArray = fc.dataset.fmminformarray !== undefined;
            if (inFormArray)
                break;
        }
        for (let p = fc === null || fc === void 0 ? void 0 : fc.parentElement; p && p.tagName !== 'FORM'; p = p.parentElement) {
            let pName = p.getAttribute('formarrayname');
            if (!pName) {
                pName = p.getAttribute('formgroupname');
                if (pName)
                    path = pName + '.' + path;
            }
            else if (!inFormArray) {
                path = pName + '.' + path;
            }
            else {
                inFormArray = false;
                path = pName;
            }
        }
        const ac = this.formGroup.get(path);
        return ac ? new StoreItem(e, this.listener, path, ac) : undefined;
    }
    // =============================================================================================================================
    notifyMinimap(minimap, on) {
        if (on)
            this.minimaps.add(minimap);
        else
            this.minimaps.delete(minimap);
    }
}
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiZm1tLW5nLm1vZHVsZS5qcyIsInNvdXJjZVJvb3QiOiIiLCJzb3VyY2VzIjpbIi4uLy4uLy4uL3NyYy9saWIvZm1tLW5nLm1vZHVsZS50cyJdLCJuYW1lcyI6W10sIm1hcHBpbmdzIjoiQUFBQSxPQUFPLEVBQUUsU0FBUyxFQUFFLFVBQVUsRUFBRSxZQUFZLEVBQUUsS0FBSyxFQUFFLFFBQVEsRUFBZ0MsTUFBTSxFQUFFLE1BQU0sZUFBZSxDQUFDO0FBRTNILE9BQU8sRUFBRSxZQUFZLEVBQUUsTUFBTSxNQUFNLENBQUM7QUFDcEMsT0FBTyxFQUNOLEdBQUcsRUFXSCxNQUFNLFlBQVksQ0FBQztBQUVwQixvSUFBb0k7QUFDcEksK0JBQStCO0FBQy9CLG9JQUFvSTtBQUVwSSxNQUFNLE9BQU8sWUFBWTtJQXdCeEIsZ0lBQWdJO0lBQ2hJLFlBQW1CLE9BQW1CO1FBVnJCLGNBQVMsR0FBRyxDQUFDLENBQUM7UUFFSixXQUFNLEdBQUcsSUFBSSxZQUFZLEVBQXNCLENBQUM7UUFTMUUsSUFBSSxJQUFJLEdBQUcsT0FBTyxDQUFDLGFBQXdCLENBQUM7UUFDNUMsT0FBTyxJQUFJLElBQUksSUFBSSxDQUFDLE9BQU8sS0FBSyxNQUFNO1lBQUUsSUFBSSxHQUFHLElBQUksQ0FBQyxhQUFhLENBQUM7UUFDbEUsSUFBSSxDQUFDLElBQUksR0FBRyxJQUF1QixDQUFDO0lBQ3JDLENBQUM7SUFFRCxnSUFBZ0k7SUFDekgsV0FBVztRQUNqQixJQUFJLENBQUMsSUFBSSxDQUFDLE9BQU87WUFBRSxPQUFPO1FBQzFCLElBQUksSUFBSSxDQUFDLEdBQUcsS0FBSyxJQUFJLENBQUMsV0FBVyxFQUFFO1lBQ2xDLElBQUksQ0FBQyxPQUFPLENBQUMsVUFBVSxFQUFFLENBQUM7WUFDMUIsSUFBSSxDQUFDLFFBQVEsRUFBRSxDQUFDO1NBQ2hCO2FBQU07WUFDTixJQUFJLENBQUMsS0FBSyxDQUFDLGdCQUFnQixHQUFHLElBQUksQ0FBQyxnQkFBZ0IsQ0FBQztZQUNwRCxJQUFJLENBQUMsT0FB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RUFBRSxFQUFFLENBQUMsQ0FBQyxDQUFDLENBQUMsU0FBUyxDQUFDO0lBQ25FLENBQUM7SUFFRCxnSUFBZ0k7SUFDekgsYUFBYSxDQUFDLE9BQW1CLEVBQUUsRUFBVztRQUNwRCxJQUFJLEVBQUU7WUFBRSxJQUFJLENBQUMsUUFBUSxDQUFDLEdBQUcsQ0FBQyxPQUFPLENBQUMsQ0FBQzs7WUFDOUIsSUFBSSxDQUFDLFFBQVEsQ0FBQyxNQUFNLENBQUMsT0FBTyxDQUFDLENBQUM7SUFDcEMsQ0FBQztDQUNEIiwic291cmNlc0NvbnRlbnQiOlsiaW1wb3J0IHsgQ29tcG9uZW50LCBFbGVtZW50UmVmLCBFdmVudEVtaXR0ZXIsIElucHV0LCBOZ01vZHVsZSwgT25DaGFuZ2VzLCBPbkRlc3Ryb3ksIE9uSW5pdCwgT3V0cHV0IH0gZnJvbSAnQGFuZ3VsYXIvY29yZSc7XG5pbXBvcnQgeyBBYnN0cmFjdENvbnRyb2wsIEZvcm1Hcm91cCB9IGZyb20gJ0Bhbmd1bGFyL2Zvcm1zJztcbmltcG9ydCB7IFN1YnNjcmlwdGlvbiB9IGZyb20gJ3J4anMnO1xuaW1wb3J0IHtcblx0Rm1tLFxuXHRGbW1FbGVtZW50RmFjdG9yeSxcblx0Rm1tRnJhbWV3b3JrLFxuXHRGbW1NYXBTdHJpbmcsXG5cdEZtbU1pbmltYXAsXG5cdEZtbU1pbmltYXBDcmVhdGVQYXJhbSxcblx0Rm1tTWluaW1hcFNuYXBzaG90LFxuXHRGbW1QYW5lbCxcblx0Rm1tU3RvcmUsXG5cdEZtbVN0b3JlSXRlbSxcblx0Rm1tV2lkZ2V0RmFjdG9yeVxufSBmcm9tICdAZm1tcC9jb3JlJztcblxuLy8gPT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09XG4vL1x0XHRcdFx0XHRcdEYgTSBNIE4gRyBNIEkgTiBJIE0gQSBQXG4vLyA9PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT1cbkBDb21wb25lbnQoeyBzZWxlY3RvcjogJ2ZtbS1uZy1taW5pbWFwJywgdGVtcGxhdGU6ICcnIH0pXG5leHBvcnQgY2xhc3MgRm1tTmdNaW5pbWFwIGltcGxlbWVudHMgT25DaGFuZ2VzLCBPbkRlc3Ryb3ksIE9uSW5pdCwgUGFydGlhbDxGbW1NaW5pbWFwPiB7XG5cdEBJbnB1dCgpIHByaXZhdGUgYWdncmVnYXRlTGFiZWxzPzogRm1tTWFwU3RyaW5nO1xuXHRASW5wdXQoKSBwcml2YXRlIGFuY2hvcjogSFRNTEVsZW1lbnQ7XG5cdEBJbnB1dCgpIHByaXZhdGUgY3VzdG9tV2lkZ2V0SWRzOiBzdHJpbmdbXTtcblx0QElucHV0KCkgcHJpdmF0ZSBkZWJvdW5jZU1zZWM6IG51bWJlcjtcblx0QElucHV0KCkgcHJpdmF0ZSBkeW5hbWljTGFiZWxzPzogc3RyaW5nW107XG5cdEBJbnB1dCgpIHByaXZhdGUgZm9ybUdyb3VwOiBGb3JtR3JvdXA7XG5cdEBJbnB1dCgpIHByaXZhdGUgZnJhbWV3b3JrOiBGbW1GcmFtZXdvcms7XG5cdEBJbnB1dCgpIHByaXZhdGUga2V5OiBzdHJpbmc7XG5cdEBJbnB1dCgpIHByaXZhdGUgbmFtZWxlc3NDb250cm9sczogRm1tTmdOYW1lbGVzc0NvbnRyb2xzO1xuXHRASW5wdXQoKSBwcml2YXRlIHBhZ2U6IEhUTUxFbGVtZW50O1xuXHRASW5wdXQoKSBwcml2YXRlIHBhbmVsOiBGbW1OZ1BhbmVsO1xuXHRASW5wdXQoKSBwcml2YXRlIHRpdGxlOiBzdHJpbmc7XG5cdEBJbnB1dCgpIHByaXZhdGUgdXNlUGFuZWxEZXRhaWw6IGJvb2xlYW47XG5cdEBJbnB1dCgpIHByaXZhdGUgdXNlV2lkdGhUb1NjYWxlOiBib29sZWFuO1xuXHRASW5wdXQoKSBwcml2YXRlIHZlcmJvc2l0eSA9IDA7XG5cdEBJbnB1dCgpIHByaXZhdGUgd2lkZ2V0RmFjdG9yaWVzPzogRm1tV2lkZ2V0RmFjdG9yeVtdO1xuXHRAT3V0cHV0KCkgcHJpdmF0ZSByZWFkb25seSB1cGRhdGUgPSBuZXcgRXZlbnRFbWl0dGVyPEZtbU1pbmltYXBTbmFwc2hvdD4oKTtcblx0cHJpdmF0ZSByZWFkb25seSBmb3JtOiBIVE1MRm9ybUVsZW1lbnQ7XG5cblx0cHJpdmF0ZSBtaW5pbWFwOiBGbW1NaW5pbWFwO1xuXHRwcml2YXRlIHByZXZpb3VzS2V5OiBzdHJpbmc7XG5cdHByaXZhdGUgc3RvcmU6IFN0b3JlO1xuXG5cdC8vID09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09XG5cdHB1YmxpYyBjb25zdHJ1Y3Rvcihob3N0UmVmOiBFbGVtZW50UmVmKSB7XG5cdFx0bGV0IGZvcm0gPSBob3N0UmVmLm5hdGl2ZUVsZW1lbnQgYXMgRWxlbWVudDtcblx0XHR3aGlsZSAoZm9ybSAmJiBmb3JtLnRhZ05hbWUgIT09ICdGT1JNJykgZm9ybSA9IGZvcm0ucGFyZW50RWxlbWVudDtcblx0XHR0aGlzLmZvcm0gPSBmb3JtIGFzIEhUTUxGb3JtRWxlbWVudDtcblx0fVxuXG5cdC8vID09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09XG5cdHB1YmxpYyBuZ09uQ2hhbmdlcygpOiB2b2lkIHtcblx0XHRpZiAoIXRoaXMubWluaW1hcCkgcmV0dXJuO1xuXHRcdGlmICh0aGlzLmtleSAhPT0gdGhpcy5wcmV2aW91c0tleSkge1xuXHRcdFx0dGhpcy5taW5pbWFwLmRlc3RydWN0b3IoKTtcblx0XHRcdHRoaXMubmdPbkluaXQoKTtcblx0XHR9IGVsc2Uge1xuXHRcdFx0dGhpcy5zdG9yZS5uYW1lbGVzc0NvbnRyb2xzID0gdGhpcy5uYW1lbGVzc0NvbnRyb2xzO1xuXHRcdFx0dGhpcy5taW5pbWFwLmNvbXBvc2UodGhpcy5jdXN0b21XaWRnZXRJZHMpO1x0XG5cdFx0fVxuXHR9XG5cblx0Ly8gPT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT1cblx0cHVibGljIG5nT25EZXN0cm95KCk6IHZvaWQge1xuXHRcdGlmICghdGhpcy5taW5pbWFwKSByZXR1cm47XG5cdFx0dGhpcy5taW5pbWFwLmRldGFjaCgpO1xuXHRcdHRoaXMuc3RvcmUgPSB1bmRlZmluZWQ7XG5cdH1cblxuXHQvLyA9PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PVxuXHRwdWJsaWMgbmdPbkluaXQoKTogdm9pZCB7XG5cdFx0Y29uc3QgcDogRm1tTWluaW1hcENyZWF0ZVBhcmFtID0ge1xuXHRcdFx0YWdncmVnYXRlTGFiZWxzOiB0aGlzLmFnZ3JlZ2F0ZUxhYmVscyxcblx0XHRcdGFuY2hvcjogdGhpcy5hbmNob3IsXG5cdFx0XHRkZWJvdW5jZU1zZWM6IHRoaXMuZGVib3VuY2VNc2VjLFxuXHRcdFx0ZHluYW1pY0xhYmVsczogdGhpcy5keW5hbWljTGFiZWxzLFxuXHRcdFx0Zm9ybTogdGhpcy5mb3JtLFxuXHRcdFx0ZnJhbWV3b3JrOiB0aGlzLmZyYW1ld29yayxcblx0XHRcdG9uVXBkYXRlOiAoc25hcHNob3Q6IEZtbU1pbmltYXBTbmFwc2hvdCkgPT4gdGhpcy51cGRhdGUubmV4dChzbmFwc2hvdCksXG5cdFx0XHRwYWdlOiB0aGlzLnBhZ2UsXG5cdFx0XHRzdG9yZTogdGhpcy5zdG9yZSA9IG5ldyBTdG9yZSh0aGlzLmZvcm1Hcm91cCksXG5cdFx0XHR0aXRsZTogdGhpcy50aXRsZSxcblx0XHRcdHVzZVBhbmVsRGV0YWlsOiB0aGlzLnVzZVBhbmVsRGV0YWlsICE9PSB1bmRlZmluZWQsXG5cdFx0XHR1c2VXaWR0aFRvU2NhbGU6IHRoaXMudXNlV2lkdGhUb1NjYWxlICE9PSB1bmRlZmluZWQsXG5cdFx0XHR2ZXJib3NpdHk6IHRoaXMudmVyYm9zaXR5LFxuXHRcdFx0d2lkZ2V0RmFjdG9yaWVzOiB0aGlzLndpZGdldEZhY3Rvcmllc1xuXHRcdH07XG5cdFx0Y29uc3QgcGFuZWwgPSB0aGlzLnBhbmVsID8gRy5QQU5FTE1BUC5nZXQodGhpcy5wYW5lbCkgOiB1bmRlZmluZWQ7XG5cdFx0dGhpcy5taW5pbWFwID0gcGFuZWw/LmNyZWF0ZU1pbmltYXAocCk7XG5cdFx0dGhpcy5wcmV2aW91c0tleSA9IHRoaXMua2V5O1xuXHRcdHRoaXMubmdPbkNoYW5nZXMoKTtcblx0fVxuXG5cdC8vID09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09XG5cdHB1YmxpYyB0YWtlU25hcHNob3QoKTogYm9vbGVhbiB7XG5cdFx0cmV0dXJuIHRoaXMubWluaW1hcD8udGFrZVNuYXBzaG90KCk7XG5cdH1cbn1cblxuLy8gPT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09XG4vL1x0XHRcdFx0XHRcdEYgTSBNIE4gRyBQIEEgTiBFIExcbi8vID09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PVxuQENvbXBvbmVudCh7IHNlbGVjdG9yOiAnZm1tLW5nLXBhbmVsJywgdGVtcGxhdGU6ICcnIH0pXG5leHBvcnQgY2xhc3MgRm1tTmdQYW5lbCBpbXBsZW1lbnRzIE9uRGVzdHJveSwgT25Jbml0LCBQYXJ0aWFsPEZtbVBhbmVsPiB7XG5cdEBJbnB1dCgpIHByaXZhdGUgcmVhZG9ubHkgZGV0YWlsUGFyZW50OiBIVE1MRWxlbWVudDtcblx0QElucHV0KCkgcHJpdmF0ZSByZWFkb25seSB2ZXJ0aWNhbDogYm9vbGVhbjtcblxuXHRwdWJsaWMgcmVhZG9ubHkgZWY6IEZtbUVsZW1lbnRGYWN0b3J5O1xuXHRwcml2YXRlIG1pbmltYXBQYW5lbDogRm1tUGFuZWw7XG5cblx0Ly8gPT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT1cblx0cHVibGljIGNvbnN0cnVjdG9yKHByaXZhdGUgcmVhZG9ubHkgaG9zdFJlZjogRWxlbWVudFJlZikge1xuXHRcdHRoaXMuZWYgPSBuZXcgRWxlbWVudEZhY3RvcnkoaG9zdFJlZik7XG5cdH1cblxuXHQvLyA9PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PVxuXHRwdWJsaWMgbmdPbkRlc3Ryb3koKTogdm9pZCB7XG5cdFx0dGhpcy5taW5pbWFwUGFuZWwuZGVzdHJ1Y3RvcigpO1xuXHRcdEcuUEFORUxNQVAuZGVsZXRlKHRoaXMpO1xuXHRcdHRoaXMubWluaW1hcFBhbmVsID0gdW5kZWZpbmVkO1xuXHR9XG5cblx0Ly8gPT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT1cblx0cHVibGljIG5nT25Jbml0KCk6IHZvaWQge1xuXHRcdGNvbnN0IGhvc3QgPSB0aGlzLmhvc3RSZWYubmF0aXZlRWxlbWVudCBhcyBIVE1MRWxlbWVudDtcblx0XHRjb25zdCB2ZXJ0aWNhbCA9IHRoaXMudmVydGljYWwgIT09IHVuZGVmaW5lZDtcblx0XHR0aGlzLm1pbmltYXBQYW5lbCA9IEZtbS5jcmVhdGVQYW5lbCh0aGlzLmVmLCBob3N0LCB0aGlzLmRldGFpbFBhcmVudCwgdmVydGljYWwpO1xuXHRcdEcuUEFORUxNQVAuc2V0KHRoaXMsIHRoaXMubWluaW1hcFBhbmVsKTtcblx0fVxuXG5cdC8vID09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09XG5cdHB1YmxpYyBkZXN0cm95RGV0YWNoZWQoKTogdm9pZCB7XG5cdFx0cmV0dXJuIHRoaXMubWluaW1hcFBhbmVsPy5kZXN0cm95RGV0YWNoZWQoKTtcblx0fVxufVxuXG4vLyA9PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT1cbi8vXHRcdFx0XHRcdFx0RiBNIE0gTiBHIE0gTyBEIFUgTCBFXG4vLyA9PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT1cbkBOZ01vZHVsZSh7IGRlY2xhcmF0aW9uczogW0ZtbU5nTWluaW1hcCwgRm1tTmdQYW5lbF0sIGV4cG9ydHM6IFtGbW1OZ01pbmltYXAsIEZtbU5nUGFuZWxdIH0pXG5leHBvcnQgY2xhc3MgRm1tTmdNb2R1bGUge31cblxuLy8gPT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09XG4vL1x0XHRcdFx0XHRcdEYgTSBNIE4gRyBOIEEgTSBFIEwgRSBTIFMgQyBPIE4gVCBSIE8gTCBTXG4vLyA9PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT1cbmV4cG9ydCB0eXBlIEZtbU5nTmFtZWxlc3NDb250cm9scyA9IFJlY29yZDxzdHJpbmcsIEFic3RyYWN0Q29udHJvbD47XG5cbi8vID09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PVxuLy8gPT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09XG4vLyA9PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09XHRQIFIgSSBWIEEgVCBFXHQ9PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT1cbi8vID09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PVxuLy8gPT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09XG5cbi8vID09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PVxuLy9cdFx0XHRcdFx0XHRFIEwgRSBNIEUgTiBUIEYgQSBDIFQgTyBSIFlcbi8vID09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PVxuY2xhc3MgRWxlbWVudEZhY3RvcnkgaW1wbGVtZW50cyBGbW1FbGVtZW50RmFjdG9yeSB7XG5cdHByaXZhdGUgcmVhZG9ubHkgbmdDb250ZW50QXR0cmlidXRlOiBzdHJpbmc7XG5cblx0Ly8gPT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT1cblx0cHVibGljIGNvbnN0cnVjdG9yKHJlZjogRWxlbWVudFJlZikge1xuXHRcdGxldCBuZ0NvbnRlbnRBdHRyaWJ1dGU6IHN0cmluZzsgLy8gc2V0IGF0dHJpYnV0ZSBvbiBlbGVtZW50cyB0byB1c2Ugbm9uLWdsb2JhbCBDU1Ncblx0XHRpZiAoRWxlbWVudC5wcm90b3R5cGUuZ2V0QXR0cmlidXRlTmFtZXMgIT09IHVuZGVmaW5lZCkge1xuXHRcdFx0Zm9yIChsZXQgcCA9IHJlZi5uYXRpdmVFbGVtZW50IGFzIEVsZW1lbnQ7IHAgJiYgIW5nQ29udGVudEF0dHJpYnV0ZTsgcCA9IHAucGFyZW50RWxlbWVudCkge1xuXHRcdFx0XHRjb25zdCBuYW1lcyA9IHAuZ2V0QXR0cmlidXRlTmFtZXMoKTtcblx0XHRcdFx0bmdDb250ZW50QXR0cmlidXRlID0gbmFtZXMuZmluZCgoYTogc3RyaW5nKSA9PiBhLnN0YXJ0c1dpdGgoJ19uZ2NvbnRlbnQtJykpO1xuXHRcdFx0fVxuXHRcdH0gZWxzZSB7XG5cdFx0XHRmb3IgKGxldCBwID0gcmVmLm5hdGl2ZUVsZW1lbnQgYXMgRWxlbWVudDsgcCAmJiAhbmdDb250ZW50QXR0cmlidXRlOyBwID0gcC5wYXJlbnRFbGVtZW50KSB7XG5cdFx0XHRcdGNvbnN0IG5hbWVzID0gQXJyYXkucHJvdG90eXBlLm1hcC5jYWxsKHAuYXR0cmlidXRlcywgKGE6IEF0dHIpID0+IGEubmFtZSkgYXMgc3RyaW5nW107XG5cdFx0XHRcdG5nQ29udGVudEF0dHJpYnV0ZSA9IG5hbWVzLmZpbmQoKGE6IHN0cmluZykgPT4gYS5zdGFydHNXaXRoKCdfbmdjb250ZW50LScpKTtcblx0XHRcdH1cblx0XHR9XG5cdFx0aWYgKCFuZ0NvbnRlbnRBdHRyaWJ1dGUpIHRocm93IG5ldyBFcnJvcignRm9ybU1pbmltYXA6IG1pc3NpbmcgX25nY29udGVudC0gYXR0cmlidXRlJyk7XG5cdFx0dGhpcy5uZ0NvbnRlbnRBdHRyaWJ1dGUgPSBuZ0NvbnRlbnRBdHRyaWJ1dGU7XG5cdH1cblxuXHQvLyA9PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PVxuXHRwdWJsaWMgY3JlYXRlRWxlbWVudCh0YWdOYW1lOiBzdHJpbmcpIHtcblx0XHRjb25zdCBlID0gZG9jdW1lbnQuY3JlYXRlRWxlbWVudCh0YWdOYW1lKTtcblx0XHRlLnNldEF0dHJpYnV0ZSh0aGlzLm5nQ29udGVudEF0dHJpYnV0ZSwgJycpO1xuXHRcdHJldHVybiBlO1xuXHR9XG5cblx0Ly8gPT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT1cblx0cHVibGljIGNyZWF0ZUVsZW1lbnROUyhuYW1lc3BhY2VVUkk6IHN0cmluZywgcXVhbGlmaWVkTmFtZTogc3RyaW5nKSB7XG5cdFx0Y29uc3QgZSA9IGRvY3VtZW50LmNyZWF0ZUVsZW1lbnROUyhuYW1lc3BhY2VVUkksIHF1YWxpZmllZE5hbWUpO1xuXHRcdGUuc2V0QXR0cmlidXRlKHRoaXMubmdDb250ZW50QXR0cmlidXRlLCAnJyk7XG5cdFx0cmV0dXJuIGU7XG5cdH1cbn1cblxuLy8gPT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09XG4vL1x0XHRcdFx0XHRcdEdcbi8vID09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PVxuY29uc3QgRzoge1xuXHRQQU5FTE1BUDogV2Vha01hcDxGbW1OZ1BhbmVsLCBGbW1QYW5lbD47XG59ID0ge1xuXHRQQU5FTE1BUDogbmV3IFdlYWtNYXAoKVxufTtcblxuLy8gPT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09XG4vL1x0XHRcdFx0XHRcdFMgVCBPIFIgRSBJIFQgRSBNXG4vLyA9PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT1cbmNsYXNzIFN0b3JlSXRlbSBpbXBsZW1lbnRzIEZtbVN0b3JlSXRlbSB7XG5cdHByaXZhdGUgcmVhZG9ubHkgc2U6IEhUTUxTZWxlY3RFbGVtZW50O1xuXG5cdC8vID09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09XG5cdHB1YmxpYyBjb25zdHJ1Y3Rvcihcblx0XHRlOiBIVE1MRWxlbWVudCxcblx0XHRsaXN0ZW5lcjogRXZlbnRMaXN0ZW5lcixcblx0XHRwcml2YXRlIHJlYWRvbmx5IG5hbWU6IHN0cmluZyxcblx0XHRwcml2YXRlIHJlYWRvbmx5IGNvbnRyb2w6IEFic3RyYWN0Q29udHJvbFxuXHQpIHtcblx0XHR0aGlzLnNlID0gZS50YWdOYW1lID09PSAnU0VMRUNUJyA/IChlIGFzIEhUTUxTZWxlY3RFbGVtZW50KSA6IHVuZGVmaW5lZDtcblx0XHRjb25zdCBzdWJzY3JpcHRpb24gPSBuZXcgU3Vic2NyaXB0aW9uKCk7XG5cdFx0c3Vic2NyaXB0aW9uLmFkZCh0aGlzLmNvbnRyb2wuc3RhdHVzQ2hhbmdlcy5zdWJzY3JpYmUobGlzdGVuZXIpKTtcblx0XHRzdWJzY3JpcHRpb24uYWRkKHRoaXMuY29udHJvbC52YWx1ZUNoYW5nZXMuc3Vic2NyaWJlKGxpc3RlbmVyKSk7XG5cdFx0dGhpcy5kZXN0cnVjdG9yID0gKCkgPT4gc3Vic2NyaXB0aW9uLnVuc3Vic2NyaWJlKCk7XG5cdH1cblxuXHQvLyA9PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PVxuXHRwdWJsaWMgZGVzdHJ1Y3RvcigpOiB2b2lkIHtcblx0XHQvLyBmdW5jdGlvbiBib2R5IG92ZXJ3cml0dGVuIGluIGNvbnN0cnVjdG9yXG5cdH1cblxuXHQvLyA9PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PVxuXHRwdWJsaWMgZ2V0RXJyb3IoaGFzVmFsdWU6IGJvb2xlYW4pOiBzdHJpbmcge1xuXHRcdGNvbnN0IGVycm9ycyA9IHRoaXMuY29udHJvbC5lcnJvcnM7XG5cdFx0bGV0IGtleXMgPSBlcnJvcnMgPyBPYmplY3Qua2V5cyhlcnJvcnMpIDogW107XG5cdFx0aWYgKGhhc1ZhbHVlICYmIGtleXMubGVuZ3RoKSBrZXlzID0ga2V5cy5maWx0ZXIoayA9PiBrICE9PSAncmVxdWlyZWQnKTsgLy8gSUUxMSBTRUxFQ1QgYnVnXG5cdFx0cmV0dXJuIGtleXMubGVuZ3RoID8ga2V5cy5qb2luKCcsJykgOiB1bmRlZmluZWQ7XG5cdH1cblxuXHQvLyA9PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PVxuXHRwdWJsaWMgZ2V0TmFtZSgpOiBzdHJpbmcge1xuXHRcdHJldHVybiB0aGlzLm5hbWU7XG5cdH1cblxuXHQvLyA9PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PVxuXHRwdWJsaWMgZ2V0VmFsdWUoKSB7XG5cdFx0Y29uc3QgdmFsdWUgPSB0aGlzLmNvbnRyb2wudmFsdWUgYXMgdW5rbm93bjtcblx0XHRpZiAoIXZhbHVlKSByZXR1cm4gdW5kZWZpbmVkO1xuXHRcdGlmICghdGhpcy5zZSkgcmV0dXJuIHZhbHVlO1xuXHRcdGlmICghdGhpcy5zZS5tdWx0aXBsZSkgcmV0dXJuIFt0aGlzLnNlLnNlbGVjdGVkSW5kZXhdO1xuXHRcdGNvbnN0IGluZGV4ZXM6IG51bWJlcltdID0gW107IC8vIEZvcm1Db250cm9sIGZvciBtdWx0aXNlbGVjdCBkb2Vzbid0IHVwZGF0ZSB3aGVuIHNlbGVjdGVkIG9wdGlvbiBpcyByZW1vdmVkIGR5bmFtaWNhbGx5XG5cdFx0QXJyYXkuZnJvbSh0aGlzLnNlLm9wdGlvbnMpLmZvckVhY2goKG8sIGkpID0+IG8uc2VsZWN0ZWQgJiYgaW5kZXhlcy5wdXNoKGkpKTtcblx0XHRyZXR1cm4gaW5kZXhlcztcblx0fVxuXG5cdC8vID09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09XG5cdHB1YmxpYyBpc0Rpc2FibGVkKCkge1xuXHRcdHJldHVybiB0aGlzLmNvbnRyb2wuZGlzYWJsZWQ7XG5cdH1cbn1cblxuLy8gPT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09XG4vL1x0XHRcdFx0XHRcdFMgVCBPIFIgRVxuLy8gPT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09XG5jbGFzcyBTdG9yZSBpbXBsZW1lbnRzIEZtbVN0b3JlIHtcblx0cHVibGljIG5hbWVsZXNzQ29udHJvbHM6IEZtbU5nTmFtZWxlc3NDb250cm9scyA9IHt9O1xuXHRwcml2YXRlIHJlYWRvbmx5IGxpc3RlbmVyOiBFdmVudExpc3RlbmVyO1xuXHRwcml2YXRlIHJlYWRvbmx5IG1pbmltYXBzOiBTZXQ8Rm1tTWluaW1hcD4gPSBuZXcgU2V0KCk7XG5cblx0Ly8gPT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT1cblx0cHVibGljIGNvbnN0cnVjdG9yKHByaXZhdGUgcmVhZG9ubHkgZm9ybUdyb3VwOiBGb3JtR3JvdXApIHtcblx0XHR0aGlzLmxpc3RlbmVyID0gKCkgPT4gdGhpcy5taW5pbWFwcy5mb3JFYWNoKG0gPT4gbS50YWtlU25hcHNob3QoKSk7XG5cdH1cblxuXHQvLyA9PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PVxuXHRwdWJsaWMgY3JlYXRlU3RvcmVJdGVtKGU6IEhUTUxFbGVtZW50LCBfOiAoKSA9PiBGbW1TdG9yZUl0ZW0pIHtcblx0XHRjb25zdCBuYW1lID0gZS5nZXRBdHRyaWJ1dGUoJ25hbWUnKSB8fCBlLmlkO1xuXHRcdGNvbnN0IGNvbnRyb2wgPSBuYW1lID8gdGhpcy5uYW1lbGVzc0NvbnRyb2xzW25hbWVdIDogdW5kZWZpbmVkO1xuXHRcdGlmIChjb250cm9sKSByZXR1cm4gbmV3IFN0b3JlSXRlbShlLCB0aGlzLmxpc3RlbmVyLCBuYW1lLCBjb250cm9sKTtcblx0XHRsZXQgaW5Gb3JtQXJyYXkgPSBmYWxzZTtcblx0XHRsZXQgcGF0aDogc3RyaW5nO1xuXHRcdGxldCBmYyA9IGU7XG5cdFx0Zm9yICg7IGZjICYmIGZjLnRhZ05hbWUgIT09ICdGT1JNJzsgZmMgPSBmYy5wYXJlbnRFbGVtZW50KSB7XG5cdFx0XHRwYXRoID0gZmMuZ2V0QXR0cmlidXRlKCdmb3JtY29udHJvbG5hbWUnKSB8fCBmYy5kYXRhc2V0LmZvcm1jb250cm9sbmFtZTtcblx0XHRcdGlmIChwYXRoKSBicmVhaztcblx0XHRcdGluRm9ybUFycmF5ID0gZmMuZGF0YXNldC5mbW1pbmZvcm1hcnJheSAhPT0gdW5kZWZpbmVkO1xuXHRcdFx0aWYgKGluRm9ybUFycmF5KSBicmVhaztcblx0XHR9XG5cdFx0Zm9yIChsZXQgcCA9IGZjPy5wYXJlbnRFbGVtZW50OyBwICYmIHAudGFnTmFtZSAhPT0gJ0ZPUk0nOyBwID0gcC5wYXJlbnRFbGVtZW50KSB7XG5cdFx0XHRsZXQgcE5hbWUgPSBwLmdldEF0dHJpYnV0ZSgnZm9ybWFycmF5bmFtZScpO1xuXHRcdFx0aWYgKCFwTmFtZSkge1xuXHRcdFx0XHRwTmFtZSA9IHAuZ2V0QXR0cmlidXRlKCdmb3JtZ3JvdXBuYW1lJyk7XG5cdFx0XHRcdGlmIChwTmFtZSkgcGF0aCA9IHBOYW1lICsgJy4nICsgcGF0aDtcblx0XHRcdH0gZWxzZSBpZiAoIWluRm9ybUFycmF5KSB7XG5cdFx0XHRcdHBhdGggPSBwTmFtZSArICcuJyArIHBhdGg7XG5cdFx0XHR9IGVsc2Uge1xuXHRcdFx0XHRpbkZvcm1BcnJheSA9IGZhbHNlO1xuXHRcdFx0XHRwYXRoID0gcE5hbWU7XG5cdFx0XHR9XG5cdFx0fVxuXHRcdGNvbnN0IGFjID0gdGhpcy5mb3JtR3JvdXAuZ2V0KHBhdGgpO1xuXHRcdHJldHVybiBhYyA/IG5ldyBTdG9yZUl0ZW0oZSwgdGhpcy5saXN0ZW5lciwgcGF0aCwgYWMpIDogdW5kZWZpbmVkO1xuXHR9XG5cblx0Ly8gPT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT1cblx0cHVibGljIG5vdGlmeU1pbmltYXAobWluaW1hcDogRm1tTWluaW1hcCwgb246IGJvb2xlYW4pIHtcblx0XHRpZiAob24pIHRoaXMubWluaW1hcHMuYWRkKG1pbmltYXApO1xuXHRcdGVsc2UgdGhpcy5taW5pbWFwcy5kZWxldGUobWluaW1hcCk7XG5cdH1cbn1cbiJdfQ==